<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build Template :: Knative Tutorial</title>
    <link rel="canonical" href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial-build/0.5.0/build-templates.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://redhat-developer-demos.github.io/knative-tutorial">Knative Tutorial</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container"  data-component="knative-tutorial-build"
  data-version="0.5.0" >
  <aside class="navigation">
    <div class="panels">
      <div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Kuberntes Native Build</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="build.html#build-prerequisite">1.Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="build.html">2. Build</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-edit-cr-secret">Edit Container Registry Secret</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-edit-build-spec">Edit Build Spec</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-edit-knative-service">Edit Knative Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="build.html#build-apply-prereq-resources">Apply Resources</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="build.html#build-create-build">Create Build</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="build.html#build-see-what-you-have-deployed">See What You Have Deployed</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-build-status">Check Build Status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-deploy-service-build">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-build-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="build-templates.html">3. Build Template</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#build-template-template">Build Template</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#build-template-edit-service">Edit Knative Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="#build-template-apply-resources">Apply Resources</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#build-template-create-template">Create Build Template</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#build-see-what-you-have-deployed">See What You Have Deployed</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#build-deploy-service-build-template">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#build-template-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#build-template-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="build.html#build-watching-logs">4.Watching Logs</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
  <div class="navigation-explore" data-panel="explore">
  <div class="context">
    <!-- Just a place holder to fill in  explorer for each context -->
  </div>
</div>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../../knative-tutorial/0.5.0/index.html" class="home-link"></a>
  <nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Kuberntes Native Build</a></li>
    <li class="crumb"><a href="build-templates.html">3. Build Template</a></li>
  </ul>
</nav>
</div>
<article class="doc">
<h1>Build Template</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The raw builds like what we did in <a href="#">ROOT:05-build/build.adoc</a> has some disadvantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No reusability</p>
</li>
<li>
<p>Hard coding of build parameters</p>
</li>
<li>
<p>Inability to make builds and services asynchronous i.e. services are deployed only after the related build is complete</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One of the solutions to these problems is <strong>Build Templates</strong>.</p>
</div>
<div class="paragraph">
<p>Similar to the build spec, the Knative build template spec and the Knative service spec needs some customizations before being applied.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-template-prerequisite"><a class="anchor" href="#build-template-prerequisite"></a>Prerequisite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following checks ensure that each chapter exercises are done with the right environment settings.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_minikube"></a>Minikube</p>
</li>
<li>
<p><a id="tabset1_minishift"></a>Minishift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_minikube">
<div class="ulist">
<ul>
<li>
<p>Set your local docker to use minikube docker daemon</p>
</li>
</ul>
</div>
<div id="minikube-set-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">eval $(minikube docker-env)</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#minikube-set-env"><i class="fa fa-copy"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>Kubernetes should be v1.12+</p>
</li>
</ul>
</div>
<div id="kubectl-version" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl version</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#kubectl-version"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset1_minishift">
<div class="ulist">
<ul>
<li>
<p>Set your local docker to use minishift docker daemon</p>
</li>
</ul>
</div>
<div id="minishift-set-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">eval $(minishift docker-env)</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#minishift-set-env"><i class="fa fa-copy"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>OpenShift CLI should be v3.11.0+</p>
</li>
</ul>
</div>
<div id="oc-version" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">eval $(minishift oc-env)
oc version</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#oc-version"><i class="fa fa-copy"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>Make sure to be on <code>knativetutorial</code> OpenShift project</p>
</li>
</ul>
</div>
<div id="right-openshift-project" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project -q</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#right-openshift-project"><i class="fa fa-copy"></i></button><br/>
<div class="paragraph">
<p>If you are not on <code>knativetutorial</code> project, then run following command to change to <code>knativetutorial</code> project:</p>
</div>
<div id="change-to-openshift-project" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project knativetutorial</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#change-to-openshift-project"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Please ensure that you have <a href="#">ROOT:05-build/build.adoc#build-registry-account</a> created.</p>
</li>
<li>
<p><a href="#">ROOT:05-build/build.adoc#build-set-env</a> has been configured.</p>
</li>
<li>
<p>Pre-requisite <a href="#">ROOT:05-build/build.adoc#build-apply-prereq-resources</a> have been created and applied.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="build-template-template"><a class="anchor" href="#build-template-template"></a>Knative build template</h3>
<div class="paragraph">
<p>Navigate to the <code>$TUTORIAL_HOME/05-build/knative</code> folder:</p>
</div>
<div id="build-navigate-to-folder" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $TUTORIAL_HOME/05-build/knative</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#build-navigate-to-folder"><i class="fa fa-copy"></i></button><br/>
<div class="paragraph">
<p>For this chapter&#8217;s build template demos, we will be using the following Knative build template that will use maven to build the Java application. The build template leverages <a href="https://buildah.io">buildah</a> to build and push the container image based on the Java application built using maven.</p>
</div>
<div class="listingblock">
<div class="title">maven-build-template.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: build.knative.dev/v1alpha1
kind: BuildTemplate
metadata:
  name: build-java-maven
spec:
  parameters: <i class="conum" data-value="1"></i><b>(1)</b>
    - description: |
        The name of the image to push.
      name: IMAGE
    - description: |
        The context directory from where to run the build.
      name: CONTEXT_DIR
  steps:
    - args:
        - "/usr/local/bin/buildah.sh"
      env:
        - name: WORK_DIR
          value: ${CONTEXT_DIR}
        - name: DESTINATION_NAME
          value: ${IMAGE}
        # uncomment this if you have MAVEN_MIRROR thats is reachable from your kube cluster
        # speeds up the builds - the example below uses Nexus repo manager installed in host machine
        # - name: MAVEN_MIRROR_URL
        #  value: $http://192.168.64.1:8081/nexus/content/groups/public
      image: quay.io/rhdevelopers/quarkus-java-builder
      name: build-and-push
      # needed for buildah builds to be running as containers
      securityContext:
        capabilities:
          add: ["SYS_ADMIN"]
      volumeMounts:
        - mountPath: /root/.m2
          name: m2-cache
        - mountPath: /var/lib/containers
          name: container-storage
      workingDir: ${CONTEXT_DIR}
  timeout: 60m
  volumes:
    - name: m2-cache
      persistentVolumeClaim:
        claimName: m2-cache
    - name: container-storage
      hostPath:
        path: /var/lib/containers</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The build template does not have any hard-coded values, *the dynamic values could be passed using <strong>parameters</strong> of the template.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The build done by the build steps of the template is exactly same like what was done by <a href="#">ROOT:05-build/build.adoc#build-create-build</a>, but templates gives flexibility and ease of configuration via parameters. The template step(s) modifications are transparent to the consumers (the builds inheriting the template), the builds using the template will automatically inherit the modified steps.</p>
</div>
</div>
<div class="sect2">
<h3 id="build-template-edit-service"><a class="anchor" href="#build-template-edit-service"></a>Edit Knative service</h3>
<div class="paragraph">
<p>Run the following command to create the knative service that will use the image created by the Knative build template we defined earlier.</p>
</div>
<div id="build-template-run-edit-service" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yq w -i service-with-build-template.yaml 'spec.runLatest.configuration.build.spec.template.arguments[0].value' $DESTINATION_IMAGE_NAME &amp;&amp; \
yq w -i service-with-build-template.yaml 'spec.runLatest.configuration.build.spec.template.arguments[1].value' "/workspace/$CONTEXT_DIR" &amp;&amp; \
yq w -i service-with-build-template.yaml 'spec.runLatest.configuration.build.spec.source.git.url' $SOURCE_REPO_URL &amp;&amp; \
yq w -i service-with-build-template.yaml 'spec.runLatest.configuration.build.spec.source.git.revision' $SOURCE_REVISION &amp;&amp; \
yq w -i service-with-build-template.yaml 'spec.runLatest.configuration.revisionTemplate.spec.container.image' $DESTINATION_IMAGE_NAME</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#build-template-run-edit-service"><i class="fa fa-copy"></i></button><br/>
<div class="paragraph">
<p>Running the above command will result in the following knative service file:</p>
</div>
<div class="listingblock">
<div class="title">service-with-build-template.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: serving.knative.dev/v1alpha1
kind: Service
metadata:
  name: event-greeter
spec:
  runLatest:
    configuration:
      build:
        apiVersion: build.knative.dev/v1alpha1
        kind: Build
        spec:
          serviceAccountName: build-bot
          source:
            git:
              revision: v0.0.2 <i class="conum" data-value="1"></i><b>(1)</b>
              url: https://github.com/redhat-developer-demos/knative-tutorial-greeter.git
          template:
            arguments: <i class="conum" data-value="2"></i><b>(2)</b>
              - name: IMAGE
                value: docker.io/demo/event-greeter:0.0.2
              - name: CONTEXT_DIR
                value: /workspace/java/quarkus
            name: build-java-maven <i class="conum" data-value="3"></i><b>(3)</b>
          timeout: 20m
      revisionTemplate:
        metadata:
          labels:
            app: event-greeter
        spec:
          container:
            image: docker.io/demo/event-greeter:0.0.2</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using another branch from the sources, just to differentiate the image produced by this build</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Passing the parameters required by the build template, not passing the required parameters will result in build validation failure</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The name of the build template to use</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The above yaml has dummy values for IMAGE, CONTEXT_DIR etc., the actual values will be based on what you set in <code>setenv.sh</code>. For more details check the  <a href="#">ROOT:05-build/build.adoc#build-set-env</a> section.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="build-template-apply-resources"><a class="anchor" href="#build-template-apply-resources"></a>Apply resources</h3>
<div class="paragraph">
<p>As we have already <a href="#">ROOT:05-build/build.adoc#build-apply-prereq-resources</a> resources, lets jump straight to applying the template and service.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-template-create-template"><a class="anchor" href="#build-template-create-template"></a>Create build template</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset2_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_kubectl">
<div id="build-create-template-kn-resources-apply" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/05-build/knative/maven-build-template.yaml">maven-build-template.yaml</a></code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#build-create-template-kn-resources-apply"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset2_oc">
<div id="build-create-template-oc-kn-resources-apply" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/05-build/knative/maven-build-template.yaml">maven-build-template.yaml</a></code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#build-create-template-oc-kn-resources-apply"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build-see-what-you-have-deployed"><a class="anchor" href="#build-see-what-you-have-deployed"></a>See what you have deployed</h3>
<div class="sect3">
<h4 id="build-show-knative-build-templates"><a class="anchor" href="#build-show-knative-build-templates"></a>build templates</h4>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset3_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_kubectl">
<div id="knative-build-templates" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl --namespace knativetutorial get buildtemplates.build.knative.dev build-java-maven</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#knative-build-templates"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset3_oc">
<div id="oc-knative-build-templates" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc --namespace knativetutorial get buildtemplates.build.knative.dev build-java-maven</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#oc-knative-build-templates"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-deploy-service-build-template"><a class="anchor" href="#build-deploy-service-build-template"></a>Deploy service using Build Template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With build templates the automatic build may not be triggered unless and until some service or build referring to the template gets created.</p>
</div>
<div class="paragraph">
<p>Run the following commands to deploy the service:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset4_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_kubectl">
<div id="build-template-deploy-service-kn-resources-apply" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/05-build/knative/service-with-build-template.yaml">service-with-build-template.yaml</a></code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#build-template-deploy-service-kn-resources-apply"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset4_oc">
<div id="build-template-deploy-service-oc-kn-resources-apply" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/05-build/knative/service-with-build-template.yaml">service-with-build-template.yaml</a></code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#build-template-deploy-service-oc-kn-resources-apply"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can also <a href="#">ROOT:05-build/build.adoc#build-watching-logs</a> of the build triggered with the service deployment.</p>
</div>
<div class="paragraph">
<p>After successful deployment of the service we should see a Kubernetes deployment like <code>event-greeter-8fvqf-deployment</code> available.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-template-invoke-service"><a class="anchor" href="#build-template-invoke-service"></a>Invoke Service</h2>
<div class="sectionbody">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset5_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset5_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset5_kubectl">
<div id="build-tpl-is-kubectl-svc-gateway-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">IP_ADDRESS="$(minikube ip):$(kubectl get svc istio-ingressgateway --namespace istio-system --output 'jsonpath={.spec.ports[?(@.port==80)].nodePort}')"</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#build-tpl-is-kubectl-svc-gateway-env"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset5_oc">
<div id="build-tpl-is-oc-svc-gateway-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">IP_ADDRESS="$(minishift ip):$(oc get svc istio-ingressgateway --namespace istio-system --output 'jsonpath={.spec.ports[?(@.port==80)].nodePort}')"</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#build-tpl-is-oc-svc-gateway-env"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
<div id="build-template-invoke-svc" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">http POST $IP_ADDRESS \
  'Host:event-greeter.knativetutorial.example.com'  \
  'Accept:*/*' \
   message="test message"</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#build-template-invoke-svc"><i class="fa fa-copy"></i></button><br/>
<div class="paragraph">
<p>The above command should return an response like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "host": "Event  greeter =&gt; 'event-greeter-5cbh5-pod-52d8fb' : 1",
    "message": "test message",
    "time": "05:34:05"
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="build-template-cleanup"><a class="anchor" href="#build-template-cleanup"></a>Cleanup</h3>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset6_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset6_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset6_kubectl">
<div id="build-template-run-cleanup" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl -n knativetutorial delete services.serving.knative.dev event-greeter
kubectl -n knativetutorial delete buildtemplates.build.knative.dev build-java-maven</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#build-template-run-cleanup"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset6_oc">
<div id="build-template-run-oc-cleanup" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n knativetutorial delete services.serving.knative.dev event-greeter
oc -n knativetutorial delete buildtemplates.build.knative.dev build-java-maven</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#build-template-run-oc-cleanup"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also delete <a href="#">ROOT:05-build/build.adoc#build-apply-prereq-resources</a> that were created if you don&#8217;t need them anymore.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer role="contentinfo">
  <div class="region region-rhd-footer">
    <div id="block-rhdfooter" class="rhd-footer">
      <nav class="rhd-footer-nav" aria-label="Secondary Navigation" role="navigation">
        <ul class="rhd-menu">
          <li class="menu-item menu-item--expanded">
            <h3 class="section-toggle">GitHub</h3>
            <ul class="rhd-menu">
              <li class="menu-item">
                <a href="https://github.com/redhat-developer-demos/knative-tutorial" title="Knative Tutorial">Knative
                  Tutorial</a>
              </li>
              <li class="menu-item">
                <a href="https://github.com/redhat-developer-demos/knative-tutorial/issues" title="Issue Tracker">Issue
                  Tracker</a>
              </li>
              <li class="menu-item">
                <a href="https://github.com/openshift-cloud-functions/Documentation"
                  title="OpenShift Cloud Functions">OpenShift Cloud Functions</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <div class="rhd-footer-sidebar">
        <p class="rhd-footer-sidebar-title">Red Hat Developer</p>
        <p class="rhd-footer-sidebar-subtitle">Build here. Go anywhere.</p>
        <p class="rhd-footer-sidebar-content">
          We serve the builders. The problem solvers who create careers with
          code.<br /><br /><a href="https://developer.redhat.com/register">Join us</a>
          if you’re a developer, software engineer, web designer, front-end
          designer, UX designer, computer scientist, architect, tester,
          product manager, project manager or team lead.
        </p>
        <ul class="rhd-footer-sidebar-social">
          <li>
            <a href="https://www.youtube.com/channel/UC7noUdfWp-ukXUlAsJnSm-Q" target="_blank"
              rel="noopener noreferrer"><svg class="svg-inline--fa fa-youtube fa-w-18" aria-hidden="true"
                data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 576 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z">
                </path>
              </svg><!-- <i class="fab fa-youtube"></i> --></a>
          </li>
          <li>
            <a href="https://www.facebook.com/RedHatDeveloperProgram" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-facebook fa-w-14" aria-hidden="true" data-prefix="fab" data-icon="facebook"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M448 56.7v398.5c0 13.7-11.1 24.7-24.7 24.7H309.1V306.5h58.2l8.7-67.6h-67v-43.2c0-19.6 5.4-32.9 33.5-32.9h35.8v-60.5c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9h-58.4v67.6h58.4V480H24.7C11.1 480 0 468.9 0 455.3V56.7C0 43.1 11.1 32 24.7 32h398.5c13.7 0 24.8 11.1 24.8 24.7z">
                </path>
              </svg><!-- <i class="fab fa-facebook"> </i> --></a>
          </li>
          <li>
            <a href="https://twitter.com/rhdevelopers" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-twitter fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="twitter"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z">
                </path>
              </svg><!-- <i class="fab fa-twitter"> </i> --></a>
          </li>
          <li>
            <a href="https://github.com/redhat-developer" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-github fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="github"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                </path>
              </svg><!-- <i class="fab fa-github"> </i> --></a>
          </li>
        </ul>
        <a class="rhd-footer-sidebar-signup" href="https://developers.redhat.com/register">Sign me up ▸</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>
