<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build Template :: Knative Tutorial</title>
    <link rel="canonical" href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial/v1.0/04build/build-templates.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="#">Knative Tutorial</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Project</div>
          <div class="navbar-dropdown">
            <div class="navbar-item"><strong>GitHub</strong></div>
            <a class="navbar-item" href="https://github.com/redhat-developer-demos/knative-tutorial">Knative Tutorial
              Repository</a>
            <a class="navbar-item" href="https://github.com/redhat-developer-demos/knative-tutorial/issues">Knative
              Tutorial Issue Tracker</a>
            <a class="navbar-item" href="https://github.com/openshift-cloud-functions/Documentation">OpenShift Cloud
              Functions
            </a>
          </div>
        </div>
        <a class="navbar-item" href="https://twitter.com/rhdevelopers">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path fill="#57aaee" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header><div class="main-wrapper">
<div class="navigation-container" data-component="knative-tutorial" data-version="v1.0">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Knative Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup.html#download-tutorial-sources">Download Tutorial Sources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../setup.html#kubernetes-cluster">Kubernetes Cluster</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../setup.html#install-knative-minikube">Install with Minikube </a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../setup.html#start-minikube">Configure and Start minikube </a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../setup.html">Install Knative </a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../setup.html#install-knative-istio">Install Istio </a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../setup.html#install-knative-serving">Install Knative Serving </a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../setup.html#install-knative-build">Install Knative Build</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../setup.html#install-knative-eventing">Install Knative Eventing </a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../setup.html#set-knative-tutorial-ns">Configuring Kubernetes namespace </a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../setup.html#install-knative-openshift">Install with OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../setup.html#install-knative-ocp">Install on OCP</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../setup.html#install-knative-minishift">Install on Minishift</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../setup.html#configure-openshift-project">Configure OpenShift project</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup.html#setup-work-folder">Work Folder</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../01basic-fundas.html">2. Basics and Fundamentals</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01basic-fundas.html#basics-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01basic-fundas.html#basics-build-containers">Build Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01basic-fundas.html#basics-deploy-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01basic-fundas.html#basics-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01basic-fundas.html#basics-see-what-you-have-deployed">See what you have deployed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01basic-fundas.html#deploying-new-revision">Deploy new Revision Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01basic-fundas.html#basics-pinning-revision">Pinning service to a revision</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../01basic-fundas.html#basics-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../02configs-and-routes.html">3. Configurations and Routes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02configs-and-routes.html#crtd-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02configs-and-routes.html#ctrd-build-containers">Build Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02configs-and-routes.html#crtd-deploy-configuration">Deploy Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02configs-and-routes.html#crtd-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02configs-and-routes.html#crtd-deploy-route">Deploy Route</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02configs-and-routes.html#crtd-see-what-you-have-deployed">See what you have deployed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02configs-and-routes.html#crtd-deploying-new-revision">Deploy new Revision Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02configs-and-routes.html#crtd-distributing-traffic">Distributing Traffic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../02configs-and-routes.html#ctrd-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../03scaling.html">4. Scaling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03scaling.html#scaling-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03scaling.html#scaling-build-containers">Build Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03scaling.html#scaling-deploy-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03scaling.html#scaling-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../03scaling.html#scaling-scale-to-zero">Scale to Zero</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../03scaling.html#scaling-observer-scale-to-zero">Observing default scale down </a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../03scaling.html#scaling-observer-scale-to-zero-1m">Change scale to zero time</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../03scaling.html#scaling-reset-to-defaults">Reset to Defaults</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../03scaling.html#scaling-auto-scaling">Auto Scaling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../03scaling.html#scaling-autoscaling-deploy-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../03scaling.html#scaling-autoscaling-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../03scaling.html#scaling-load-service">Load Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../03scaling.html#scaling-min-scale">Minimum Scale</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../03scaling.html#scaling-deploy-service-minscale">Deploy service </a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../03scaling.html#scaling-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="build.html">5. Build</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="build.html#build-prerequisite">Prerequisites</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="build.html#build-create-docker-secret">Generate Docker Secret</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="build.html#build-generate-build-spec">Generate Build Spec</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="build.html#build-generate-knative-service">Generate Knative service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="build.html#build-apply-prereq-resources">Apply Resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-create-build">Create Build</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-see-what-you-have-deployed">See what you have deployed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-watching-logs">Watching logs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-build-status">Build Status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-deploy-service-build">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build.html#build-build-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="build-templates.html">6. Build Template</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="#build-template-prerequisite">Prerequisites</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#build-template-generate-template">Generate build template</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#build-template-generate-service">Generate Knative service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#build-template-apply-resources">Apply Resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="#build-template-create-template">Create Build Template</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#build-see-what-you-have-deployed">See what you have deployed</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#build-deploy-service-build-template">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#build-template-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#build-template-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../05eventing/eventing.html">7. Eventing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05eventing/eventing.html#eventing-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05eventing/eventing.html#eventing-assumptions">Assumptions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../05eventing/eventing.html#eventing-watch-logs">Watching Logs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../05eventing/eventing-src-svc.html">Source to Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../05eventing/eventing-src-svc.html#eventing-source">Event Source</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../05eventing/eventing-src-svc.html#eventing-create-event-source">Create Event Source</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../05eventing/eventing-src-svc.html#eventing-verify-event-source">Verify</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../05eventing/eventing-src-svc.html#eventing-sink-service">Sink Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../05eventing/eventing-src-svc.html#eventing-gen-sink-service">Generate Service</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../05eventing/eventing-src-svc.html#eventing-deploy-sink-service">Deploy Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../05eventing/eventing-src-svc.html#eventing-see-what-you-have-deployed">See what you have deployed</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../05eventing/eventing-src-svc.html#eventing-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../05eventing/eventing-src-sub.html">Source to Subscriber</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-channel">Channel</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-create-event-channel">Create Event Channel</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-verify-event-channel">Verify</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-source">Event Source</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-create-event-source">Create Event Source</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-verify-event-source">Verify</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-subscriber">Event Subscriber</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-create-subscriber">Create Event Subscriber</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-verify-subscriber">Verify</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-see-what-you-have-deployed">See what you have deployed</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-subscriber-service">Subscriber Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-gen-subscriber-service">Generate Service</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-deploy-subscriber-service">Deploy Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../05eventing/eventing-src-sub.html#eventing-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../faq.html">Frequently Asked Questions</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Knative Tutorial</span>
    <span class="version">v1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Knative Tutorial</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">Knative Tutorial</a></li>
    <li class="crumb"><a href="build-templates.html">6. Build Template</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///root/project/documentation/modules/ROOT/pages/04build/build-templates.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Build Template</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The raw builds like what we did in <a href="build.html" class="page">previous chapter</a> has some disadvantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No reusability</p>
</li>
<li>
<p>Hard coding of build parameters</p>
</li>
<li>
<p>Inability to make builds and services in synchronous i.e. services are deployed only after the related build is complete</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One of the solution to these problems is by using <strong>Build Templates</strong>.</p>
</div>
<div class="paragraph">
<p>Like the build spec the knative build template spec and knative service spec also needs some customizations before apply them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-template-prerequisite"><a class="anchor" href="#build-template-prerequisite"></a>Prerequisite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following checks ensures that each chapter exercises are done with right environment settings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure to be connected to minikube or minishift docker daemon and using right openshift client.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">eval $(minikube docker-env)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">(OR)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">eval $(minishift docker-env) &amp;&amp; eval $(minishift oc-env)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure right OpenShift and kubernetes client are used.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># kubernetes v1.12+
kubectl version</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">(OR)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># oc v3.11.0+0cbc58b kubernetes v1.11.0+d4cacc0
oc version</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure right maven version is used (only for Java exercises)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># right maven version Apache Maven 3.5.x or above
./mvnw --version</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure to be on <code>knativetutorial</code> OpenShift project/kubernetes namespace</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># verify to return knativetutorial
oc project -q</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are not on <code>knativetutorial</code> project, use the command <code>oc project knativetutorial</code> to change to <code>knativetutorial</code> project</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Please ensure that you have <a href="build.html#build-registry-account" class="page"> registry account</a> created.</p>
</li>
<li>
<p>Pre-requisite <a href="build.html#build-apply-prereq-resources" class="page">kubernetes resources</a> have been created and applied.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="build-template-generate-template"><a class="anchor" href="#build-template-generate-template"></a>Generate build template</h3>
<div class="paragraph">
<p>Navigate to the tutorial chapter&#8217;s <code>templates</code> folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $TUTORIAL_HOME/04-build/knative/templates</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">jsonnet <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/04-build/knative/templates/maven-build-template.jsonnet">maven-build-template.jsonnet</a> \
  | yq r - | tee ../maven-build-template.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command will generate a knative build specification as shown below:</p>
</div>
<div class="listingblock text-center">
<div class="title">maven-build-template.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: build.knative.dev/v1alpha1
kind: BuildTemplate
metadata:
  name: build-java-maven
spec:
  parameters: <i class="conum" data-value="1"></i><b>(1)</b>
  - description: |
      The name of the image to push.
    name: IMAGE
  - description: |
      The context directory from where to run the build.
    name: CONTEXT_DIR
  steps:
  - args:
    - clean
    - package
    - -Duser.home=/builder/home
    - -Dimage=${IMAGE}
    image: gcr.io/cloud-builders/mvn
    name: build-maven
    volumeMounts:
    - mountPath: /builder/home/.m2
      name: m2-cache
    - mountPath: /cache
      name: kaniko-cache
    workingDir: /workspace/${CONTEXT_DIR}
  - args:
    - --context=/workspace/${CONTEXT_DIR}
    - --dockerfile=/workspace/${CONTEXT_DIR}/Dockerfile
    - --destination=${IMAGE}
    env:
    - name: DOCKER_CONFIG
      value: /builder/home/.docker
    image: gcr.io/kaniko-project/executor
    name: docker-push
    volumeMounts:
    - mountPath: /cache
      name: kaniko-cache
    workingDir: /workspace/${CONTEXT_DIR}
  volumes:
  - name: m2-cache
    persistentVolumeClaim:
      claimName: m2-cache
  - name: kaniko-cache
    persistentVolumeClaim:
      claimName: kaniko-cache</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The build template does not have any hard-coded values, *the dynamic values could be passed using <strong>parameters</strong> of the template.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The build done by the build steps of the template is exactly same like what was done by <a href="build.html#build-create-build" class="page">raw build</a>, but templates gives flexibility and ease of configuration via parameters. The template step(s) modifications are transparent to the consumers (the builds inheriting the template), the builds using the template will automatically inherit the modified steps.</p>
</div>
</div>
<div class="sect2">
<h3 id="build-template-generate-service"><a class="anchor" href="#build-template-generate-service"></a>Generate Knative service</h3>
<div class="paragraph">
<p>Run the following command to create the knative service that will use the image created by the <code>docker-build</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">jsonnet --ext-str contextDir='&lt;the context dir within the application source&gt;' \
   --ext-str image='&lt;the container image to use' \
   <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/04-build/knative/templates/service-with-build-template.jsonnet">service-with-build-template.jsonnet</a> \
    | yq r - | tee ../service-with-build-template.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>(e.g.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">jsonnet --ext-str contextDir='java/springboot' \
   --ext-str image='docker.io/demo/event-greeter:0.0.2' \
   <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/04-build/knative/templates/service-with-build-template.jsonnet">service-with-build-template.jsonnet</a> \
    | yq r - | tee ../service-with-build-template.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running the above command will result in the following knative service:</p>
</div>
<div class="listingblock text-center">
<div class="title">service-with-build-template.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: serving.knative.dev/v1alpha1
kind: Service
metadata:
  name: event-greeter
spec:
  runLatest:
    configuration:
      build:
        apiVersion: build.knative.dev/v1alpha1
        kind: Build
        spec:
          serviceAccountName: build-bot
          source:
            git:
              revision: v0.0.2 <i class="conum" data-value="1"></i><b>(1)</b>
              url: https://github.com/redhat-developer-demos/knative-tutorial-event-greeter.git
          template:
            arguments: <i class="conum" data-value="2"></i><b>(2)</b>
              - name: IMAGE
                value: docker.io/demo/event-greeter:0.0.2
              - name: CONTEXT_DIR
                value: java/springboot
            name: build-java-maven <i class="conum" data-value="3"></i><b>(3)</b>
          timeout: 20m
      revisionTemplate:
        metadata:
          labels:
            app: event-greeter
        spec:
          container:
            image: docker.io/kameshsampath/event-greeter:0.0.2</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using another branch from the sources, just to differentiate the image produced by this build</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Passing the parameters required by the build template, not passing the required parameters will result in build validation failure</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The name of the build template to use</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="build-template-apply-resources"><a class="anchor" href="#build-template-apply-resources"></a>Apply resources</h3>
<div class="paragraph">
<p>As we have already <a href="build.html#build-apply-prereq-resources" class="page">applied the pre-req</a> resources, lets jump straight to applying the template and service.</p>
</div>
<div class="paragraph">
<p>Navigate to the tutorial chapter&#8217;s <code>knative</code> folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $TUTORIAL_HOME/04-build/knative</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-template-create-template"><a class="anchor" href="#build-template-create-template"></a>Create build template</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -n knativetutorial -f maven-build-template.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">(OR)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -n knativetutorial -f maven-build-template.yaml</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="build-see-what-you-have-deployed"><a class="anchor" href="#build-see-what-you-have-deployed"></a>See what you have deployed</h3>
<div class="sect3">
<h4 id="build-show-knative-build-templates"><a class="anchor" href="#build-show-knative-build-templates"></a>build templates</h4>
<div id="knative-build-templates" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl -n knativetutorial get buildtemplates.build.knative.dev build-java-maven</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">(OR)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># get a knative build template called  build-java-maven
oc -n knativetutorial get buildtemplates.build.knative.dev build-java-maven</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-deploy-service-build-template"><a class="anchor" href="#build-deploy-service-build-template"></a>Deploy service using Build Template</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With build templates the automatic build may not be triggered unless and until some service or build referring to the template gets created.</p>
</div>
<div class="paragraph">
<p>Run the following commands to deploy the service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -n knativetutorial -f service-with-build-template.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">(OR)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -n knativetutorial -f service-with-build-template.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also <a href="build.html#build-watching-logs" class="page">watch the logs</a> of the build triggered with the service deployment.</p>
</div>
<div class="paragraph">
<p>After successful deployment of the service we should see a kubernetes deployment called <code>event-greeter-00001-deployment</code> available.</p>
</div>
<div class="imageblock thumb">
<div class="content">
<img src="../_images/event-greeter-00001.png" alt="Event Greeter Service">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-template-invoke-service"><a class="anchor" href="#build-template-invoke-service"></a>Invoke Service</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">INGRESSGATEWAY=istio-ingressgateway
IP_ADDRESS="$(minishift ip):$(kubectl get svc $INGRESSGATEWAY --namespace istio-system --output 'jsonpath={.spec.ports[?(@.port==80)].nodePort}')"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -H "Host: event-greeter.knativetutorial.example.com" $IP_ADDRESS \
   -H "Content-Type: application/json" \
   -d '{"message": "test message"}'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">(OR)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">http POST $IP_ADDRESS \
  'Host: event-greeter.knativetutorial.example.com'  \
   message="test message"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command should return an response like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "host": "Event greeter v0.0.2 =&gt; 'event-greeter-00001-deployment-67f96d589b-fgcj2' : 2 ",
    "message": "test message"
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="build-template-cleanup"><a class="anchor" href="#build-template-cleanup"></a>Cleanup</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl -n knativetutorial delete services.serving.knative.dev event-greeter
kubectl -n knativetutorial delete buildtemplates.build.knative.dev build-java-maven</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">(OR)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n knativetutorial delete services.serving.knative.dev event-greeter
oc -n knativetutorial delete buildtemplates.build.knative.dev build-java-maven</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also delete <a href="build.html#build-apply-prereq-resources" class="page">pre-req resources</a> that were created if you dont need them any more.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This content is brought to you by <a href="http://developers.redhat.com">Red Hat Developer</a> - Register today!.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
