<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup :: Knative Tutorial</title>
    <link rel="canonical" href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial/dev/setup.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="#">Knative Tutorial</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Project</div>
          <div class="navbar-dropdown">
            <div class="navbar-item"><strong>GitHub</strong></div>
            <a class="navbar-item" href="https://github.com/redhat-developer-demos/knative-tutorial">Knative Tutorial
              Repository</a>
            <a class="navbar-item" href="https://github.com/redhat-developer-demos/knative-tutorial/issues">Knative
              Tutorial Issue Tracker</a>
            <a class="navbar-item" href="https://github.com/openshift-cloud-functions/Documentation">OpenShift Cloud
              Functions
            </a>
          </div>
        </div>
        <a class="navbar-item" href="https://twitter.com/rhdevelopers">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path fill="#57aaee" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header><div class="main-wrapper">
<div class="navigation-container" data-component="knative-tutorial" data-version="dev">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Knative Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#download-tutorial-sources">Download Tutorial Sources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#minishift">Setup MiniShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#admission-controller-webhook">Enable Admission Controller Webhook </a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#setup-knative">Setup Knative</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#install-istio">Install Istio</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#install-knative-build">Install Knative Build</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#install-knative-serving">Install Knative Serving</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#install-knative-eventing">Install Eventing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#configure-openshift-project">Configure OpenShift project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#setup-work-folder">Work Folder</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="01basic-fundas.html">2. Basics and Fundamentals</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01basic-fundas.html#basics-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01basic-fundas.html#basics-build-containers">Build Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01basic-fundas.html#basics-deploy-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01basic-fundas.html#basics-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01basic-fundas.html#basics-see-what-you-have-deployed">See what you have deployed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01basic-fundas.html#deploying-new-revision">Deploy new Revision Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01basic-fundas.html#basics-pinning-revision">Pinning service to a revision</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01basic-fundas.html#basics-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="02configs-and-routes.html">3. Configurations and Routes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02configs-and-routes.html#crtd-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02configs-and-routes.html#ctrd-build-containers">Build Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02configs-and-routes.html#crtd-deploy-configuration">Deploy Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02configs-and-routes.html#crtd-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02configs-and-routes.html#crtd-deploy-route">Deploy Route</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02configs-and-routes.html#crtd-see-what-you-have-deployed">See what you have deployed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02configs-and-routes.html#crtd-deploying-new-revision">Deploy new Revision Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02configs-and-routes.html#crtd-distributing-traffic">Distributing Traffic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02configs-and-routes.html#ctrd-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="03scaling.html">4. Scaling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03scaling.html#scaling-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03scaling.html#scaling-build-containers">Build Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03scaling.html#scaling-deploy-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03scaling.html#scaling-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="03scaling.html#scaling-scale-to-zero">Scale to Zero</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03scaling.html#scaling-observer-scale-to-zero">Observing default scale down </a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03scaling.html#scaling-observer-scale-to-zero-1m">Change scale to zero time</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03scaling.html#scaling-reset-to-defaults">Reset to Defaults</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="03scaling.html#scaling-auto-scaling">Auto Scaling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03scaling.html#scaling-autoscaling-deploy-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03scaling.html#scaling-autoscaling-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03scaling.html#scaling-load-service">Load Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="03scaling.html#scaling-min-scale">Minimum Scale</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03scaling.html#scaling-deploy-service-minscale">Deploy service </a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03scaling.html#scaling-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="04build.html">5. Build</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="04build.html#build-prerequisite">Prerequisites</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04build.html#build-create-docker-secret">Generate Docker Secret</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04build.html#build-generate-build-spec">Generate Build Spec</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04build.html#build-generate-knative-service">Generate Knative service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04build.html#build-apply-preeq-resouces">Apply Resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04build.html#build-create-build">Create Build</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04build.html#build-see-what-you-have-deployed">See what you have deployed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04build.html#build-watching-logs">Watching logs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04build.html#build-build-status">Build Status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04build.html#build-deploy-service-build">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04build.html#build-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04build.html#build-build-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05build-templates.html">6. Build Template</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05build-templates.html#build-template-prerequisite">Prerequisites</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05build-templates.html#build-template-generate-template">Generate build template</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05build-templates.html#build-template-generate-service">Generate Knative service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05build-templates.html#build-template-apply-resources">Apply Resources</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05build-templates.html#build-template-create-template">Create Build Template</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05build-templates.html#build-see-what-you-have-deployed">See what you have deployed</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05build-templates.html#build-deploy-service-build-template">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05build-templates.html#build-template-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05build-templates.html#build-template-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="faq.html">Frequently Asked Questions</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Knative Tutorial</span>
    <span class="version">dev</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Knative Tutorial</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">dev</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Knative Tutorial</a></li>
    <li class="crumb"><a href="setup.html">1. Setup</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/kameshs/git/kameshsampath/knative-tutorial/documentation/modules/ROOT/pages/setup.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Setup</h1>
<div class="sect1">
<h2 id="prerequisite"><a class="anchor" href="#prerequisite"></a>Prerequisite CLI tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You will need in this tutorial:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Tool</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>macOS</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Fedora</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>minishift</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://github.com/minishift/minishift/releases" class="bare">https://github.com/minishift/minishift/releases</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://github.com/minishift/minishift/releases" class="bare">https://github.com/minishift/minishift/releases</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">docker</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://www.docker.com/docker-mac">Docker for Mac</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dnf install docker</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl">kubectl</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl-binary-via-curl">Mac OS</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dnf install kubernetes-client</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://maven.apacge.org">Apache Maven</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>brew install maven</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dnf install maven</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://github.com/wercker/stern">stern</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>brew install stern</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sudo curl --output /usr/local/bin/stern -L <a href="https://github.com/wercker/stern/releases/download/1.6.0/stern_linux_amd64" class="bare">https://github.com/wercker/stern/releases/download/1.6.0/stern_linux_amd64</a> &amp;&amp; sudo chmod +x /usr/local/bin/stern</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>curl</code>, <code>gunzip</code>, <code>tar</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">built-in or part of your bash shell</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">should also be installed already, but just in case&#8230;&#8203; <code>dnf install curl gzip tar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">git</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>brew install git</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dnf install git</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="http://xmlstar.sourceforge.net/">xmlstarlet</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>brew install xmlstarlet</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="http://xmlstar.sourceforge.net/" class="bare">http://xmlstar.sourceforge.net/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://github.com/mikefarah/yq">yq</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>brew install yq</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://github.com/mikefarah/yq/releases/latest" class="bare">https://github.com/mikefarah/yq/releases/latest</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://httpie.org/">httpie</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>brew install httpie</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dnf install httpie</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://golang.org">go</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>brew install golang</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://dl.google.com/go/go1.11.5.linux-amd64.tar.gz" class="bare">https://dl.google.com/go/go1.11.5.linux-amd64.tar.gz</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://github.com/rakyll/hey">hey</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>go get -u github.com/rakyll/hey</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>go get -u github.com/rakyll/hey</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://jsonnet.org/" class="bare">https://jsonnet.org/</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>brew install jsonnet</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="https://github.com/google/jsonnet" class="bare">https://github.com/google/jsonnet</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="download-tutorial-sources"><a class="anchor" href="#download-tutorial-sources"></a>Download Tutorial Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we start to setting up the environment, lets clone the tutorial sources and call the cloned folder as <code>$TUTORIAL_HOME</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git clone https://github.com/kameshsampath/knative-tutorial</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>work</code> folder in <code>$TUTORIAL_HOME</code> can be used to download the demo application resources and refer them during the exercises. The <code>work</code> folder has a README, which has instructions on source code repo and git commands to clone the sources.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All examples in this tutorial are tested with <strong>OpenShift 3.11</strong> and <strong>Knative 0.3.0</strong></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="minishift"><a class="anchor" href="#minishift"></a>Minishift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All the demos in this tutorial will be run using <a href="https://github.com/minishift/minishift">minishift</a>, the single node <a href="https://www.okd.io/">OKD</a>(the Origin Community Distribution of kubernetes that powers Red Hat OpenShift) cluster that can be used for development purposes.</p>
</div>
<div class="sect2">
<h3 id="_setup_minishift"><a class="anchor" href="#_setup_minishift"></a>Setup minishift</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export TIMEZONE=$(sudo systemsetup -gettimezone | awk '{print $3}') <i class="conum" data-value="1"></i><b>(1)</b>
minishift profile set knative-tutorial
minishift config set openshift-version v3.11.0
minishift config set memory 8GB # if you more then preferred is 10GB
minishift config set cpus 4
minishift config set disk-size 50g
minishift config set image-caching true
minishift addons enable admin-user

minishift start --timezone $TIMEZONE

eval $(minishift docker-env) &amp;&amp; eval $(minishift oc-env)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Some examples we use in this tutorial are time sensitive, hence its recommended to set the appropriate timezone. If you are linux please use the appropriate command to get the timezone of the host.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="admission-controller-webhook"><a class="anchor" href="#admission-controller-webhook"></a>Enable Admission Controller Webhook</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash

minishift openshift config set --target=kube --patch '{
  "admissionConfig": {
    "pluginConfig": {
      "ValidatingAdmissionWebhook": {
        "configuration": {
          "apiVersion": "apiserver.config.k8s.io/v1alpha1",
          "kind": "WebhookAdmission",
          "kubeConfigFile": "/dev/null"
        }
      },
      "MutatingAdmissionWebhook": {
        "configuration": {
          "apiVersion": "apiserver.config.k8s.io/v1alpha1",
          "kind": "WebhookAdmission",
          "kubeConfigFile": "/dev/null"
        }
      }
    }
  }
}'

# Allowing few minutes for the OpenShift to be restarted
until oc login -u admin -p admin 2&gt;/dev/null; do sleep 5; done;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup-knative"><a class="anchor" href="#setup-knative"></a>Knative Setup</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="login-as-admin"><a class="anchor" href="#login-as-admin"></a>Login as admin user</h3>
<div class="paragraph">
<p>Since there was an <code>admin</code> addon added during minishift configuration, its now possible to login with the <code>admin</code> user. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc login -u admin -p admin</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="install-istio"><a class="anchor" href="#install-istio"></a>Install Istio</h3>
<div class="sect3">
<h4 id="istio-policies"><a class="anchor" href="#istio-policies"></a>Configure Istio Policies</h4>
<div class="paragraph">
<p>Knative depends on Istio, to deploy Istio you need to run the following commands to configure necessary <a href="https://istio.io/docs/setup/kubernetes/platform-setup/openshift/">privileges</a> to the service accounts used by Istio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc adm policy add-scc-to-user anyuid -z istio-ingress-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z default -n istio-system
oc adm policy add-scc-to-user anyuid -z prometheus -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-egressgateway-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-citadel-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-ingressgateway-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-cleanup-old-ca-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-mixer-post-install-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-mixer-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-pilot-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-sidecar-injector-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z cluster-local-gateway-service-account -n istio-system
oc adm policy add-scc-to-user anyuid -z istio-galley-service-account -n istio-system</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deploy-istio"><a class="anchor" href="#deploy-istio"></a>Deploy Istio Components</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -L https://github.com/knative/serving/releases/download/v0.3.0/istio.yaml \
  | sed 's/LoadBalancer/NodePort/' \
  | kubectl apply --filename -</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The above command throws some warnings and error as to some objects not found, it can safely ignore or run the command again
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can moinitor the Istio components via the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods -n istio-system -w</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It will take a few minutes for all the Istio components to be up and running. Please wait for all the Istio pods to be running before deploying <a href="#install-knative-serving">Knative Serving</a>.  Use <span class="keyseq"><kbd>CTRL</kbd>+<kbd>C</kbd></span> to exit watch mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A successful deployment should show similar output as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get pods -n istio-system
NAME                                        READY     STATUS      RESTARTS   AGE
cluster-local-gateway-76db55c785-9f7zc      1/1       Running     0          2m
istio-citadel-746c765786-fqx8m              1/1       Running     0          2m
istio-cleanup-secrets-znzc6                 0/1       Completed   0          2m
istio-egressgateway-7b46794587-m6tqm        1/1       Running     0          2m
istio-galley-75c6976d79-bcnbp               1/1       Running     0          2m
istio-ingressgateway-57f76dc4db-85cps       1/1       Running     0          2m
istio-pilot-6495978c49-6jrmf                2/2       Running     0          2m
istio-pilot-6495978c49-7l6w7                2/2       Running     0          2m
istio-pilot-6495978c49-fh9n8                2/2       Running     0          2m
istio-policy-6677c87b9f-7wxxj               2/2       Running     0          2m
istio-sidecar-injector-879fd9dfc-82wjl      1/1       Running     0          2m
istio-statsd-prom-bridge-549d687fd9-mlnb2   1/1       Running     0          2m
istio-telemetry-7d46d668db-4qwz5            2/2       Running     0          2m</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="update-istio-sidecar-injector-configmap"><a class="anchor" href="#update-istio-sidecar-injector-configmap"></a>Update Istio sidecar injector ConfigMap</h4>
<div class="paragraph">
<p>The Istio v1.0.1 release automatic sidecar injection has removed <code>privileged:true</code> from init contianers,this will cause the Pods with istio proxies automatic inject to crash. Run the following command to update the <strong>istio-sidecar-injector</strong> ConfigMap.</p>
</div>
<div class="paragraph">
<p>The following command ensures that the <code>privileged:true</code> is added to the <strong>istio-sidecar-injector</strong> ConfigMap:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -n istio-system -f $TUTORIAL_HOME/patches/istio-sidecar-injector.yaml</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Run the above command only once per minishift instance
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="install-knative-build"><a class="anchor" href="#install-knative-build"></a>Install Knative Build</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Setup Knative Build Policies
oc adm policy add-scc-to-user anyuid -z build-controller -n knative-build
oc adm policy add-scc-to-user anyuid -z build-controller -n knative-build

# Install Knative Build components
kubectl apply --filename https://github.com/knative/build/releases/download/v0.3.0/release.yaml

# give cluster admin privileges to Service Account Build Controller on project knative-build
oc adm policy add-cluster-role-to-user cluster-admin -z build-controller -n knative-build
oc adm policy add-cluster-role-to-user cluster-admin -z build-controller -n knative-build</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods -n knative-build -w</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It will take a few minutes for all the Knative Build components to be up and running. Use <span class="keyseq"><kbd>CTRL</kbd>+<kbd>C</kbd></span> to exit watch mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A successful deployment should show similar output as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get pods -n knative-build
NAME                                READY     STATUS    RESTARTS   AGE
build-controller-79cb969d89-bnzbr   1/1       Running   0          28s
build-webhook-58d685fc58-f5s4l      1/1       Running   0          27s</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="install-knative-serving"><a class="anchor" href="#install-knative-serving"></a>Install Knative Serving</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Setup Knative Serving Policies
oc adm policy add-scc-to-user anyuid -z controller -n knative-serving
oc adm policy add-scc-to-user anyuid -z autoscaler -n knative-serving

# Install Knative Serving components
curl -L https://github.com/knative/serving/releases/download/v0.3.0/serving.yaml \
  | sed 's/LoadBalancer/NodePort/' \
  | kubectl apply --filename -

# give cluster admin privileges to Service Account Controller on project knative-serving
oc adm policy add-cluster-role-to-user cluster-admin -z controller -n knative-serving</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can monitor the Knative Serving components via  components via the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods -n knative-serving -w</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It will take a few minutes for all the Knative Serving components to be up and running. Use <span class="keyseq"><kbd>CTRL</kbd>+<kbd>C</kbd></span> to exit watch mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A successful deployment should show similar output as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get pods -n knative-serving
NAME                          READY     STATUS    RESTARTS   AGE
activator-598b4b7787-sb9gv    2/2       Running   0          35s
autoscaler-5cf5cfb4dc-9zd7p   2/2       Running   0          34s
controller-7fc84c6584-ggp7b   1/1       Running   0          38s
webhook-7797ffb6bf-swr4c      1/1       Running   0          38s</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="install-knative-eventing"><a class="anchor" href="#install-knative-eventing"></a>Install Knative Eventing</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Setup Knative Eventing Policies
oc adm policy add-scc-to-user anyuid -z eventing-controller -n knative-eventing
oc adm policy add-scc-to-user anyuid -z in-memory-channel-dispatcher -n knative-eventing
oc adm policy add-scc-to-user anyuid -z in-memory-channel-controller -n knative-eventing

# Install Knative Eventing components
kubectl apply --filename https://github.com/knative/eventing/releases/download/v0.3.0/release.yaml
kubectl apply --filename https://github.com/knative/eventing-sources/releases/download/v0.3.0/release.yaml

# give cluster admin privileges to Service Accounts on project knative-eventing
oc adm policy add-cluster-role-to-user cluster-admin -z eventing-controller -n knative-eventing
oc adm policy add-cluster-role-to-user cluster-admin -z default -n knative-sources
oc adm policy add-cluster-role-to-user cluster-admin -z in-memory-channel-dispatcher -n knative-eventing
oc adm policy add-cluster-role-to-user cluster-admin -z in-memory-channel-controller -n knative-eventing</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can monitor the Knative Eventing components via  components via the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods -n knative-eventing -w
oc get pods -n knative-sources -w</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It will take a few minutes for all the Knative Eventing components to be up and running. Use <span class="keyseq"><kbd>CTRL</kbd>+<kbd>C</kbd></span> to exit watch mode.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get pods -n knative-eventing
NAME                                            READY     STATUS    RESTARTS   AGE
eventing-controller-847d8cf969-zv77v            1/1       Running   0          1m
in-memory-channel-controller-59dd7cfb5b-s82x6   1/1       Running   0          1m
webhook-7cfff8d86d-4kljw                        1/1       Running   0          1m

$ oc get pods -n knative-sources
NAME                   READY     STATUS    RESTARTS   AGE
controller-manager-0   1/1       Running   0          1m</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-openshift-project"><a class="anchor" href="#configure-openshift-project"></a>Configuring OpenShift project for Knative applications</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-project knativetutorial
oc adm policy add-scc-to-user privileged -z default <i class="conum" data-value="1"></i><b>(1)</b>
oc adm policy add-scc-to-user anyuid -z default</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>oc adm policy</code> adds the <strong>privileged</strong> <a href="https://docs.okd.io/3.10/admin_guide/manage_scc.html">Security Context Constraints(SCCs)</a>to the <strong>default</strong> Service Account. The SCCs are the precursor to the PSP (Pod Security Policy) mechanism in kubernetes.</td>
</tr>
</table>
</div>
<div class="paragraph text-center">
<p><strong>(OR)</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create namespace knativetutorial</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup-work-folder"><a class="anchor" href="#setup-work-folder"></a>Work folder</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The work folder i.e <code>$TUTORIAL_HOME/work</code> can be used as a work directory during the build. The README in the work folder as the GitHub repository links of the applications <code>greeter</code> and <code>event-greeter</code> that will be used in various exercises.</p>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer class="footer">
  <p>This content is brought to you by <a href="http://developers.redhat.com">Red Hat Developer</a> - Register today!.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
