<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurations and Routes :: Knative Tutorial</title>
    <link rel="canonical" href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial-basics/0.5.0/03-configs-and-routes.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://redhat-developer-demos.github.io/knative-tutorial">Knative Tutorial</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container"  data-component="knative-tutorial-basics"
  data-version="0.5.0" >
  <aside class="navigation">
    <div class="panels">
      <div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Introduction to Knative</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#download-tutorial-sources">Download Tutorial Sources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#kubernetes-cluster">Kubernetes Cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="02-basic-fundas.html">2. Basics and Fundamentals</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basic-fundas.html#basics-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basic-fundas.html#basics-build-containers">Build Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basic-fundas.html#basics-deploy-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basic-fundas.html#basics-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basic-fundas.html#basics-see-what-you-have-deployed">See What You Have Deployed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basic-fundas.html#deploying-new-revision">Deploy a New Revision of a Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basic-fundas.html#basics-pinning-revision">Pinning Service to a Revision</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basic-fundas.html#basics-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="03-configs-and-routes.html">3. Configurations and Routes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#crtd-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ctrd-build-containers">Build Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#crtd-deploy-configuration">Deploy Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#crtd-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#crtd-deploy-route">Deploy Route</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#crtd-see-what-you-have-deployed">See What You Have Deployed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#crtd-deploying-new-revision">Deploy a New Revision of a Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#crtd-distributing-traffic">Distributing Traffic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#ctrd-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="04-scaling.html">4. Scaling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-scaling.html#scaling-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-scaling.html#scaling-build-containers">Build Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-scaling.html#scaling-deploy-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-scaling.html#scaling-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="04-scaling.html#scaling-scale-to-zero">Scale to Zero</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-scaling.html#scaling-observer-scale-to-zero">Observing Default Scale Down</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-scaling.html#scaling-observer-scale-to-zero-1m">Change Scale-to-Zero Time</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-scaling.html#scaling-reset-to-defaults">Reset to Defaults</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="04-scaling.html#scaling-auto-scaling">Auto Scaling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-scaling.html#scaling-autoscaling-deploy-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-scaling.html#scaling-autoscaling-invoke-service">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-scaling.html#scaling-load-service">Load Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="04-scaling.html#scaling-min-scale">Minimum Scale</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-scaling.html#scaling-deploy-service-minscale">Deploy Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-scaling.html#scaling-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05-eventing/eventing.html">5. Eventing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-eventing/eventing.html#eventing-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05-eventing/eventing-src-svc.html">Source to Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-src-svc.html#eventing-source">Event Source</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-src-svc.html#eventing-create-event-source">Create Event Source</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-src-svc.html#eventing-verify-event-source">Verify</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05-eventing/eventing-src-svc.html#eventing-sink-service">Sink Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="05-eventing/eventing-src-svc.html#eventing-gen-sink-service">Generate Service</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="05-eventing/eventing-src-svc.html#eventing-deploy-sink-service">Deploy Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-src-svc.html#eventing-see-what-you-have-deployed">See What You Have Deployed</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-src-svc.html#eventing-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05-eventing/eventing-src-sub.html">Source to Subscriber</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-channel">Channel</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-create-event-channel">Create Event Channel</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-verify-event-channel">Verify</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-source">Event Source</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-create-event-source">Create Event Source</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-verify-event-source">Verify</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-subscriber">Event Subscriber</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-create-subscriber">Create Event Subscriber</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-verify-subscriber">Verify</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-see-what-you-have-deployed">See What You Have Deployed</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-subscriber-service">Subscriber Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-gen-subscriber-service">Generate Service</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-deploy-subscriber-service">Deploy Service</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="05-eventing/eventing-src-sub.html#eventing-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05-eventing/eventing-trigger-broker.html">Triggers and Brokers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-trigger-broker.html#events-triggers-brokers">Events, Triggers and Brokers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-trigger-broker.html#broker">Broker</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-trigger-broker.html#eventing-service">Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-trigger-broker.html#eventing-event-source">Event Source</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-trigger-broker.html#eventing-trigger">Trigger</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-trigger-broker.html#eventing-verification">Verification</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-eventing/eventing-trigger-broker.html#eventing-cleanup">Cleanup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-eventing/eventing.html#eventing-watch-logs">Watching Logs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="faq.html">8. Frequently Asked Questions</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
  <div class="navigation-explore" data-panel="explore">
  <div class="context">
    <!-- Just a place holder to fill in  explorer for each context -->
  </div>
</div>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../../knative-tutorial/0.5.0/index.html" class="home-link"></a>
  <nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Introduction to Knative</a></li>
    <li class="crumb"><a href="03-configs-and-routes.html">3. Configurations and Routes</a></li>
  </ul>
</nav>
</div>
<article class="doc">
<h1>Configurations and Routes</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>At the end of this chapter you will be able to understand and know how to :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy Knative configurations and routes separately.</p>
</li>
<li>
<p>Distribute traffic between revisions of a service.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="crtd-prerequisite"><a class="anchor" href="#crtd-prerequisite"></a>Prerequisite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following checks ensure that each chapter exercises are done with the right environment settings.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_minikube"></a>Minikube</p>
</li>
<li>
<p><a id="tabset1_minishift"></a>Minishift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_minikube">
<div class="ulist">
<ul>
<li>
<p>Set your local docker to use minikube docker daemon</p>
</li>
</ul>
</div>
<div id="minikube-set-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">eval $(minikube docker-env)</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#minikube-set-env"><i class="fa fa-copy"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>Kubernetes should be v1.12+</p>
</li>
</ul>
</div>
<div id="kubectl-version" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl version</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#kubectl-version"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset1_minishift">
<div class="ulist">
<ul>
<li>
<p>Set your local docker to use minishift docker daemon</p>
</li>
</ul>
</div>
<div id="minishift-set-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">eval $(minishift docker-env)</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#minishift-set-env"><i class="fa fa-copy"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>OpenShift CLI should be v3.11.0+</p>
</li>
</ul>
</div>
<div id="oc-version" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">eval $(minishift oc-env)
oc version</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#oc-version"><i class="fa fa-copy"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>Make sure to be on <code>knativetutorial</code> OpenShift project</p>
</li>
</ul>
</div>
<div id="right-openshift-project" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project -q</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#right-openshift-project"><i class="fa fa-copy"></i></button><br/>
<div class="paragraph">
<p>If you are not on <code>knativetutorial</code> project, then run following command to change to <code>knativetutorial</code> project:</p>
</div>
<div id="change-to-openshift-project" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project knativetutorial</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#change-to-openshift-project"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ctrd-build-containers"><a class="anchor" href="#ctrd-build-containers"></a>Build Containers</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have already cloned the repo and built the <code>greeter</code> service you can skip this step.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Navigate to <code>greeter</code> app folder in $TUTORIAL_HOME</p>
</li>
</ul>
</div>
<div id="navigate-to-greeter-app-folder" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $TUTORIAL_HOME/apps/greeter</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#navigate-to-greeter-app-folder"><i class="fa fa-copy"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>Build the application and container image</p>
</li>
</ul>
</div>
<div id="build-greeter" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd java/quarkus &amp;&amp; \
./mvnw clean package &amp;&amp; \
docker build -t dev.local/rhdevelopers/greeter:0.0.1  -f Dockerfile.all .</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#build-greeter"><i class="fa fa-copy"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>Check if images are built and available:</p>
</li>
</ul>
</div>
<div id="check-greeter-images" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker images | grep dev.local</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#check-greeter-images"><i class="fa fa-copy"></i></button><br/>
<div class="paragraph">
<p>The above command should return something like as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">dev.local/rhdevelopers/greeter   0.0.1               6aa8771da8dd        2 hours ago         456MB</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="crtd-deploy-configuration"><a class="anchor" href="#crtd-deploy-configuration"></a>Deploy Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous chapter we saw how we can deploy services using a holistic service resource file, in this chapter we will see how to deploy the service using configurations and route files.</p>
</div>
<div class="paragraph">
<p>Navigate to the tutorial chapter&#8217;s folder:</p>
</div>
<div id="navigate-crtd-folder" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $TUTORIAL_HOME/03-configs-and-routes</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#navigate-crtd-folder"><i class="fa fa-copy"></i></button><br/>
<div class="sect2">
<h3 id="_deploy_configuration_revision_1"><a class="anchor" href="#_deploy_configuration_revision_1"></a>Deploy Configuration revision 1</h3>
<div class="paragraph">
<p>The following snippet shows how a Knative configuration resource YAML looks like:
.<a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/config/configuration-rev1.yaml">configuration-rev1.yaml</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: serving.knative.dev/v1alpha1
kind: Configuration
metadata:
  name: greeter
spec:
  revisionTemplate:
    metadata:
      labels:
        app: greeter
    spec:
      container:
        image: dev.local/rhdevelopers/greeter:0.0.1 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It is very important that the image is a fully qualified docker image name, including a  tag. For more details on this <a href="faq.html#faq-q2" class="page">Question 2 of FAQ</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The service is then deployed using:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset2_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_kubectl">
<div id="crtd-rev1-apply-kn-resources-apply" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/config/configuration-rev1.yaml">config/configuration-rev1.yaml</a></code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#crtd-rev1-apply-kn-resources-apply"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset2_oc">
<div id="crtd-rev1-apply-oc-kn-resources-apply" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/config/configuration-rev1.yaml">config/configuration-rev1.yaml</a></code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#crtd-rev1-apply-oc-kn-resources-apply"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>After the deployment was successful, we should see a kubernetes deployment like <code>greeter-wlcn4-deployment</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="crtd-invoke-service"><a class="anchor" href="#crtd-invoke-service"></a>Invoke Service</h2>
<div class="sectionbody">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_minikube"></a>Minikube</p>
</li>
<li>
<p><a id="tabset3_minishift"></a>Minishift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_minikube">
<div id="ctrd-is-kubectl-svc-gateway-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">IP_ADDRESS="$(minikube ip):$(kubectl get svc istio-ingressgateway --namespace istio-system --output 'jsonpath={.spec.ports[?(@.port==80)].nodePort}')"</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#ctrd-is-kubectl-svc-gateway-env"><i class="fa fa-copy"></i></button><br/>
<div id="ctrd-is-kubectl-svc-call" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">http $IP_ADDRESS 'Host:greeter.knativetutorial.example.com'</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#ctrd-is-kubectl-svc-call"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset3_minishift">
<div id="ctrd-is-oc-svc-gateway-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">IP_ADDRESS="$(minishift ip):$(oc get svc istio-ingressgateway --namespace istio-system --output 'jsonpath={.spec.ports[?(@.port==80)].nodePort}')"</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#ctrd-is-oc-svc-gateway-env"><i class="fa fa-copy"></i></button><br/>
<div id="ctrd-is-oc-svc-call" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">http $IP_ADDRESS 'Host:greeter.knativetutorial.example.com'</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#ctrd-is-oc-svc-call"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>The command will return <code>HTTP 404</code> as there are no routes deployed yet. Let us now deploy a route.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="crtd-deploy-route"><a class="anchor" href="#crtd-deploy-route"></a>Deploy Route</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let us now deploy a route that will route all the traffic to the configuration we just deployed.
.<a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_default.yaml">route_default.yaml</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: serving.knative.dev/v1alpha1
kind: Route
metadata:
  name: greeter
spec:
  traffic:
    - configurationName: greeter
      percent: 100</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset4_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_kubectl">
<div id="crtd-route-default-apply-kn-resources-apply" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_default.yaml">route/route_default.yaml</a></code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#crtd-route-default-apply-kn-resources-apply"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset4_oc">
<div id="crtd-route-default-apply-oc-kn-resources-apply" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_default.yaml">route/route_default.yaml</a></code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#crtd-route-default-apply-oc-kn-resources-apply"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#crtd-invoke-service">Invoking Service</a> now should return a response like <strong>Hi  greeter &#8658; '9be9ccd9a2e3' : 1</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sometimes the response might not be returned immediately especially when the pod is coming up from a dormant state. You might need to be a little patient :) .
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="crtd-see-what-you-have-deployed"><a class="anchor" href="#crtd-see-what-you-have-deployed"></a>See what you have deployed</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As we did not deploy a service this time</p>
</div>
<div class="sect2">
<h3 id="crtd-show-knative-services"><a class="anchor" href="#crtd-show-knative-services"></a>service</h3>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset5_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset5_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset5_kubectl">
<div id="knative-services" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl --namespace knativetutorial  get services.serving.knative.dev greeter</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#knative-services"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset5_oc">
<div id="oc-knative-services" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc --namespace knativetutorial  get services.serving.knative.dev greeter</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#oc-knative-services"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>will throw an error as there are no knative services is deployed as part of the <em>configuration + routes</em> based deployment strategy.</p>
</div>
</div>
<div class="sect2">
<h3 id="crtd-show-knative-configs"><a class="anchor" href="#crtd-show-knative-configs"></a>configuration</h3>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset6_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset6_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset6_kubectl">
<div id="knative-configs" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl --namespace knativetutorial get configurations.serving.knative.dev greeter</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#knative-configs"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset6_oc">
<div id="oc-knative-configs" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc --namespace knativetutorial get configurations.serving.knative.dev greeter</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#oc-knative-configs"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="crtd-show-knative-routes"><a class="anchor" href="#crtd-show-knative-routes"></a>routes</h3>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset7_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset7_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset7_kubectl">
<div id="knative-routes" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl --namespace knativetutorial get routes.serving.knative.dev greeter</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#knative-routes"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset7_oc">
<div id="oc-knative-routes" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc --namespace knativetutorial get routes.serving.knative.dev greeter</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#oc-knative-routes"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>When the service is invoked with <code>http $IP_ADDRESS "Host:greeter.knativetutorial.example.com"</code>, you noticed that we added a <strong>Host</strong> header to the <code>http</code> command with the value <code>greeter.knativetutorial.example.com</code>. This FQDN is automatically assigned to your Knative service by the Knative route we created. It follows a format <code>&lt;route-name&gt;.&lt;namespace&gt;.&lt;domain-suffix&gt;</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The <code>domain-suffix</code> (in this case <em>example.com</em>) is configurable via the config map <strong>config-domain</strong> in the <strong>knative-serving</strong> namespace.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="crtd-show-knative-revisions"><a class="anchor" href="#crtd-show-knative-revisions"></a>revisions</h3>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset8_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset8_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset8_kubectl">
<div id="knative-config-revisions" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl --namespace knativetutorial get rev \
  -l serving.knative.dev/configuration=greeter \
  --sort-by="{.metadata.creationTimestamp}"</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#knative-config-revisions"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset8_oc">
<div id="oc-knative-config-revisions" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc --namespace knativetutorial get rev \
  -l serving.knative.dev/configuration=greeter \
  --sort-by="{.metadata.creationTimestamp}"</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#oc-knative-config-revisions"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>add <code>-oyaml</code> to the commands above to see more details</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="crtd-deploying-new-revision"><a class="anchor" href="#crtd-deploying-new-revision"></a>Deploy a new revision</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Knative follows a revision model for its configurations. Each time you change something in the <code>revisionTemplate</code> Knative will effectively generate a new revision and thus a new deployment. In this example we add a new environment variable to demonstrate that mechanism.</p>
</div>
<div class="sect2">
<h3 id="_deploy_configuration_revision_2"><a class="anchor" href="#_deploy_configuration_revision_2"></a>Deploy configuration revision 2</h3>
<div class="listingblock">
<div class="title"><a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/config/configuration-rev2.yaml">configuration-rev2.yaml</a></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: serving.knative.dev/v1alpha1
kind: Configuration
metadata:
  name: greeter
spec:
  revisionTemplate:
    metadata:
      labels:
        app: greeter
    spec:
      container:
        image: dev.local/rhdevelopers/greeter:0.0.1
        env: <i class="conum" data-value="1"></i><b>(1)</b>
          - name: MESSAGE_PREFIX
            value: Namaste</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adding an environment variable that will be used a message prefix.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let us deploy the new revision using the command:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset9_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset9_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset9_kubectl">
<div id="crtd-rev2-apply-kn-resources-apply" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/config/configuration-rev2.yaml">config/configuration-rev2.yaml</a></code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#crtd-rev2-apply-kn-resources-apply"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset9_oc">
<div id="crtd-rev2-apply-oc-kn-resources-apply" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/config/configuration-rev2.yaml">config/configuration-rev2.yaml</a></code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#crtd-rev2-apply-oc-kn-resources-apply"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>After the deployment was successful we should see a kubernetes deployment like <code>greeter-tb57l-deployment</code>.</p>
</div>
<div class="paragraph">
<p>Now running the <a href="#crtd-show-knative-revisions">show revisions command</a> will list all the revisions sorted in descending order of its creation.</p>
</div>
<div class="paragraph">
<p><a href="#crtd-invoke-service">Invoking Service</a> will now show an output like <strong>Namaste  greeter &#8658; '9be9ccd9a2e3' : 1</strong>, where <em>Namaste</em> is the value that we configured for <code>MESSAGE_PREFIX</code> via environment variable in the Knative service resource file.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="crtd-distributing-traffic"><a class="anchor" href="#crtd-distributing-traffic"></a>Distributing traffic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When deploying services with service object based approach, the service resource will take care of traffic distribution either 100% to latest or pinned revision. In this section we will explore how we can deploy routes to distribute traffic between deployed revisions.</p>
</div>
<div class="paragraph">
<p>Before we start to apply routes, let us open a new terminal and run the following command <code>$TUTORIAL_HOME/03-configs-and-routes/bin/call.sh</code>, this command will keep sending requests to greeter route every two seconds which allows us to monitor the changes to the responses as we keep applying the route that will distribute the traffic between the available two revisions.</p>
</div>
<div class="sect2">
<h3 id="ctrd-traffic-distribution-polling"><a class="anchor" href="#ctrd-traffic-distribution-polling"></a>Polling the service</h3>
<div class="paragraph">
<p>We need to run the service invocation in loop to see the results of traffic distribution.</p>
</div>
<div id="crtd-poll-sh" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/bin/bash
set -eu
while true
do
  http --body $IP_ADDRESS 'Host:greeter.knativetutorial.example.com'
  sleep 3
done;</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#crtd-poll-sh"><i class="fa fa-copy"></i></button><br/>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Copy and save the above contents to a script file e.g. <code>$TUTORIAL_HOME/work/poll.sh</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="crtd-define-revisions"><a class="anchor" href="#crtd-define-revisions"></a>Define revisions</h3>
<div class="paragraph">
<p>For easier explanation and understanding lets give logical names to the revisions and set them to environment variables:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset10_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset10_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset10_kubectl">
<div id="ctrd-def-revisions" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">REVISION_1=`kubectl -n knativetutorial get rev -l serving.knative.dev/configuration=greeter --sort-by="{.metadata.creationTimestamp}" | awk 'NR==2{print $1}'`
REVISION_2=`kubectl -n knativetutorial get rev -l serving.knative.dev/configuration=greeter --sort-by="{.metadata.creationTimestamp}" | awk 'NR==3{print $1}'`</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#ctrd-def-revisions"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset10_oc">
<div id="ctrd-def-oc-revisions" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">REVISION_1=`oc -n knativetutorial get rev -l serving.knative.dev/configuration=greeter --sort-by="{.metadata.creationTimestamp}" | awk 'NR==2{print $1}'`
REVISION_2=`oc -n knativetutorial get rev -l serving.knative.dev/configuration=greeter --sort-by="{.metadata.creationTimestamp}" | awk 'NR==3{print $1}'`</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#ctrd-def-oc-revisions"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="crtd-all-rev1"><a class="anchor" href="#crtd-all-rev1"></a>Send all traffic to revision 1</h3>
<div class="exampleblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset11_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset11_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset11_kubectl">
<div id="all-rev1-ctrd-run-all-to-rev" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_all_rev1.yaml">route/route_all_rev1</a> |\
 yq w - 'spec.traffic[0].revisionName' $REVISION_1 | kubectl apply -n knativetutorial -f -</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#all-rev1-ctrd-run-all-to-rev"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset11_oc">
<div id="all-rev1-ctrd-run-oc-all-to-rev" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_all_rev1.yaml">route/route_all_rev1</a> |\
 yq w - 'spec.traffic[0].revisionName' $REVISION_1 | oc apply -n knativetutorial -f -</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#all-rev1-ctrd-run-oc-all-to-rev"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If <a href="#crtd-poll-sh">poll the service</a> for some time,  you will notice the service always goes to your revision 1 e.g output will be something like <strong>Hi  greeter &#8658; '9be9ccd9a2e3' : 1</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="crtd-all-rev2"><a class="anchor" href="#crtd-all-rev2"></a>Send all traffic to revision 2</h3>
<div class="exampleblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset12_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset12_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset12_kubectl">
<div id="all-rev2-ctrd-run-all-to-rev" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_all_to_revision.yaml">route/route_all_to_revision.yaml</a> |\
 yq w - 'spec.traffic[0].revisionName' $REVISION_2 | kubectl apply -n knativetutorial -f -</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#all-rev2-ctrd-run-all-to-rev"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset12_oc">
<div id="all-rev2-ctrd-run-oc-all-to-rev" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_all_to_revision.yaml">route/route_all_to_revision.yaml</a> |\
 yq w - 'spec.traffic[0].revisionName' $REVISION_2 | oc apply -n knativetutorial -f -</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#all-rev2-ctrd-run-oc-all-to-rev"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If <a href="#crtd-poll-sh">poll the service</a> for some time,  you will notice the service always goes to your revision 2 e.g output will be something like <strong>Namaste  greeter &#8658; '9be9ccd9a2e3' : 1</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="crtd-all-rev1-rev2-50"><a class="anchor" href="#crtd-all-rev1-rev2-50"></a>50-50 split between revision 1 and revision 2</h3>
<div class="exampleblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset13_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset13_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset13_kubectl">
<div id="rev1-50-rev2-50-ctrd-run-all-to-rev" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_rev1-50_rev2-50.yaml">route/route_rev1-50_rev2-50.yaml</a> |\
 yq w - 'spec.traffic[0].revisionName' $REVISION_1 | kubectl apply -n knativetutorial -f -</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#rev1-50-rev2-50-ctrd-run-all-to-rev"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset13_oc">
<div id="rev1-50-rev2-50-ctrd-run-oc-all-to-rev" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_rev1-50_rev2-50.yaml">route/route_rev1-50_rev2-50.yaml</a> |\
 yq w - 'spec.traffic[0].revisionName' $REVISION_1 | oc apply -n knativetutorial -f -</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#rev1-50-rev2-50-ctrd-run-oc-all-to-rev"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If <a href="#crtd-poll-sh">poll the service</a> for some time,  you will notice the service is distributed between revision 1 and revision 2 e.g output will be mix of responses like <strong>Hi  greeter &#8658; '9be9ccd9a2e3' : 1</strong> and <strong>Namaste  greeter &#8658; '9be9ccd9a2e3' : 1</strong>. You will also notice the traffic is distributed approximately 50% between the two revisions.</p>
</div>
</div>
<div class="sect2">
<h3 id="crtd-all-rev1-rev2-75-25"><a class="anchor" href="#crtd-all-rev1-rev2-75-25"></a>75-25 split between revision 1 and revision 2</h3>
<div class="exampleblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset14_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset14_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset14_kubectl">
<div id="rev1-75-rev2-25-ctrd-run-all-to-rev" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_rev1-75_rev2-25.yaml">route/route_rev1-75_rev2-25.yaml</a> |\
 yq w - 'spec.traffic[0].revisionName' $REVISION_1 | kubectl apply -n knativetutorial -f -</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#rev1-75-rev2-25-ctrd-run-all-to-rev"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset14_oc">
<div id="rev1-75-rev2-25-ctrd-run-oc-all-to-rev" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_rev1-75_rev2-25.yaml">route/route_rev1-75_rev2-25.yaml</a> |\
 yq w - 'spec.traffic[0].revisionName' $REVISION_1 | oc apply -n knativetutorial -f -</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#rev1-75-rev2-25-ctrd-run-oc-all-to-rev"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If <a href="#crtd-poll-sh">poll the service</a> for some time,  you will notice the service is distributed between revision 1 and revision 2 e.g output will be mix of responses like <strong>Hi  greeter &#8658; '9be9ccd9a2e3' : 1</strong> and <strong>Namaste  greeter &#8658; '9be9ccd9a2e3' : 1</strong>. You will also notice the traffic is distributed approximately 75-25% between the two revisions.</p>
</div>
</div>
<div class="sect2">
<h3 id="crtd-all-rev1-rev2-10-90"><a class="anchor" href="#crtd-all-rev1-rev2-10-90"></a>10-90 split between revision 1 and revision 2</h3>
<div class="exampleblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset15_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset15_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset15_kubectl">
<div id="rev1-rev2-10-90-ctrd-run-all-to-rev" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_rev1-10_rev2-90.yaml">route/route_rev1-10_rev2-90.yaml</a> |\
 yq w - 'spec.traffic[0].revisionName' $REVISION_1 | kubectl apply -n knativetutorial -f -</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#rev1-rev2-10-90-ctrd-run-all-to-rev"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset15_oc">
<div id="rev1-rev2-10-90-ctrd-run-oc-all-to-rev" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/03-configs-and-routes/route/route_rev1-10_rev2-90.yaml">route/route_rev1-10_rev2-90.yaml</a> |\
 yq w - 'spec.traffic[0].revisionName' $REVISION_1 | oc apply -n knativetutorial -f -</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#rev1-rev2-10-90-ctrd-run-oc-all-to-rev"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If <a href="#crtd-poll-sh">poll the service</a> for some time,  you will notice the service is distributed between revision 1 and revision 2 e.g output will be mix of responses like <strong>Hi  greeter &#8658; '9be9ccd9a2e3' : 1</strong> and <strong>Namaste  greeter &#8658; '9be9ccd9a2e3' : 1</strong>. You will also notice the traffic is distributed approximately 10-90% between the two revisions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ctrd-cleanup"><a class="anchor" href="#ctrd-cleanup"></a>Cleanup</h2>
<div class="sectionbody">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset16_kubectl"></a>kubectl</p>
</li>
<li>
<p><a id="tabset16_oc"></a>oc</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset16_kubectl">
<div id="crtd-run-cleanup" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl -n knativetutorial delete configurations.serving.knative.dev greeter
kubectl -n knativetutorial delete routes.serving.knative.dev greeter</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#crtd-run-cleanup"><i class="fa fa-copy"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset16_oc">
<div id="crtd-run-oc-cleanup" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc -n knativetutorial delete configurations.serving.knative.dev greeter
oc -n knativetutorial delete routes.serving.knative.dev greeter</code></pre>
</div>
</div>
<button class="copybtn" title="Copy to clipboard" data-clipboard-target="#crtd-run-oc-cleanup"><i class="fa fa-copy"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer role="contentinfo">
  <div class="region region-rhd-footer">
    <div id="block-rhdfooter" class="rhd-footer">
      <nav class="rhd-footer-nav" aria-label="Secondary Navigation" role="navigation">
        <ul class="rhd-menu">
          <li class="menu-item menu-item--expanded">
            <h3 class="section-toggle">GitHub</h3>
            <ul class="rhd-menu">
              <li class="menu-item">
                <a href="https://github.com/redhat-developer-demos/knative-tutorial" title="Knative Tutorial">Knative
                  Tutorial</a>
              </li>
              <li class="menu-item">
                <a href="https://github.com/redhat-developer-demos/knative-tutorial/issues" title="Issue Tracker">Issue
                  Tracker</a>
              </li>
              <li class="menu-item">
                <a href="https://github.com/openshift-cloud-functions/Documentation"
                  title="OpenShift Cloud Functions">OpenShift Cloud Functions</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <div class="rhd-footer-sidebar">
        <p class="rhd-footer-sidebar-title">Red Hat Developer</p>
        <p class="rhd-footer-sidebar-subtitle">Build here. Go anywhere.</p>
        <p class="rhd-footer-sidebar-content">
          We serve the builders. The problem solvers who create careers with
          code.<br /><br /><a href="https://developer.redhat.com/register">Join us</a>
          if you’re a developer, software engineer, web designer, front-end
          designer, UX designer, computer scientist, architect, tester,
          product manager, project manager or team lead.
        </p>
        <ul class="rhd-footer-sidebar-social">
          <li>
            <a href="https://www.youtube.com/channel/UC7noUdfWp-ukXUlAsJnSm-Q" target="_blank"
              rel="noopener noreferrer"><svg class="svg-inline--fa fa-youtube fa-w-18" aria-hidden="true"
                data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 576 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z">
                </path>
              </svg><!-- <i class="fab fa-youtube"></i> --></a>
          </li>
          <li>
            <a href="https://www.facebook.com/RedHatDeveloperProgram" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-facebook fa-w-14" aria-hidden="true" data-prefix="fab" data-icon="facebook"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M448 56.7v398.5c0 13.7-11.1 24.7-24.7 24.7H309.1V306.5h58.2l8.7-67.6h-67v-43.2c0-19.6 5.4-32.9 33.5-32.9h35.8v-60.5c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9h-58.4v67.6h58.4V480H24.7C11.1 480 0 468.9 0 455.3V56.7C0 43.1 11.1 32 24.7 32h398.5c13.7 0 24.8 11.1 24.8 24.7z">
                </path>
              </svg><!-- <i class="fab fa-facebook"> </i> --></a>
          </li>
          <li>
            <a href="https://twitter.com/rhdevelopers" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-twitter fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="twitter"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z">
                </path>
              </svg><!-- <i class="fab fa-twitter"> </i> --></a>
          </li>
          <li>
            <a href="https://github.com/redhat-developer" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-github fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="github"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                </path>
              </svg><!-- <i class="fab fa-github"> </i> --></a>
          </li>
        </ul>
        <a class="rhd-footer-sidebar-signup" href="https://developers.redhat.com/register">Sign me up ▸</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>
