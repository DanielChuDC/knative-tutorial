<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knative Tutorial :: Knative Tutorial</title>
    <link rel="canonical" href="https://redhat-developer-demos.github.io/knative-tutorial/knative-tutorial-tekton/0.7.x/04-pipelines.html">
    <meta name="generator" content="Antora 2.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://redhat-developer-demos.github.io/knative-tutorial">Knative Tutorial</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container"  data-component="knative-tutorial-tekton"
  data-version="0.7.x" >
  <aside class="navigation">
    <div class="panels">
      <div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Tekton Pipelines</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#tekton-prerequisites">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#deploy-tekton">Deploy Tekton</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#install-tekton-cli">Install Tekton CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="02-pipeline-resources.html">2. Pipeline Resources</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-pipeline-resources.html#tekton-res-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-pipeline-resources.html#tekton-res-create">Create Pipeline Resource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-pipeline-resources.html#tekton-res-deploy">Deploy Pipeline Resource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-pipeline-resources.html#tkn-see-what-you-have-deployed">See what you have deployed</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="03-tasks.html">3. Tasks</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-tasks.html#tekton-task-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-tasks.html#tekton-task-create">Create a task</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-tasks.html#tekton-task-deploy">Deploy task</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="03-tasks.html#tekton-task-run">TaskRun</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-tasks.html#tekton-task-run-create">Create TaskRun</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-tasks.html#tekton-task-run-run">Run the Task</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-tasks.html#tekton-test-task-output">Test Task output</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-tasks.html#tekton-task-cleanup">Clean</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="04-pipelines.html">4. Pipelines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tekton-task-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tekton-add-tasks">Add Tasks from Catalog</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tekton-pipeline-create">Create Pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tekton-pipeline-deploy">Deploy Pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tekton-pipeline-run">Run Pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tekton-test-pipeline">Test Pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#tekton-pipeline-cleanup">Clean</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
  <div class="navigation-explore" data-panel="explore">
  <div class="context">
    <!-- Just a place holder to fill in  explorer for each context -->
  </div>
</div>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../../knative-tutorial/0.7.x/index.html" class="home-link"></a>
  <nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Tekton Pipelines</a></li>
    <li class="crumb"><a href="04-pipelines.html">4. Pipelines</a></li>
  </ul>
</nav>
</div>
<article class="doc">
<h1>Knative Tutorial</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>At the end of this chapter you will be able to :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Understand what is a <a href="https://github.com/tektoncd/pipeline/blob/master/docs/pipelines.md">Pipeline</a> ?</p>
</li>
<li>
<p>Add Tasks from Catalog</p>
</li>
<li>
<p>Create a Pipeline</p>
</li>
<li>
<p>Execute a Pipeline to build and deploy a Knative service</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tekton-task-prerequisite"><a class="anchor" href="#tekton-task-prerequisite"></a>Prerequisite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following checks ensure that each chapter exercises are done with the right environment settings.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_kubernetes"></a>Kubernetes</p>
</li>
<li>
<p><a id="tabset1_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_kubernetes">
<div class="ulist">
<ul>
<li>
<p>Set your local docker to use minikube docker daemon</p>
</li>
</ul>
</div>
<div id="minikube-set-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">eval $(minikube docker-env)</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#minikube-set-env"><i class="fa fa-clipboard"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>Kubernetes should be v1.12+</p>
</li>
</ul>
</div>
<div id="kubectl-version" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl version</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#kubectl-version"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset1_openshift">
<div class="ulist">
<ul>
<li>
<p>OpenShift CLI should be v4.1+</p>
</li>
</ul>
</div>
<div id="oc-version" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc version</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#oc-version"><i class="fa fa-clipboard"></i></button><br/>
<div class="ulist">
<ul>
<li>
<p>Make sure to be on <code>knativetutorial</code> OpenShift project</p>
</li>
</ul>
</div>
<div id="right-openshift-project" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project -q</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#right-openshift-project"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>If you are not on <code>knativetutorial</code> project, then run following command to change to <code>knativetutorial</code> project:</p>
</div>
<div id="change-to-openshift-project" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project knativetutorial</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#change-to-openshift-project"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>Ensure Tekton piplines is deployed and the API is available for use</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_kubernetes"></a>Kubernetes</p>
</li>
<li>
<p><a id="tabset2_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_kubernetes">
<div id="tekton-api-kind-k8s" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl api-resources --api-group='tekton.dev'</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-api-kind-k8s"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset2_openshift">
<div id="tekton-api-kind-oc" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc api-resources --api-group='tekton.dev'</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-api-kind-oc"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>The command show an output like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                SHORTNAMES   APIGROUP     NAMESPACED   KIND
clustertasks                     tekton.dev   false        ClusterTask
conditions                       tekton.dev   true         Condition
pipelineresources                tekton.dev   true         PipelineResource
pipelineruns        pr,prs       tekton.dev   true         PipelineRun
pipelines                        tekton.dev   true         Pipeline
taskruns            tr,trs       tekton.dev   true         TaskRun
tasks                            tekton.dev   true         Task</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify the Tekton cli</p>
</div>
<div id="tekton-install-cli" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tkn version</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-install-cli"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>The command should show a result like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Client version: 0.4.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ensure the pipeline Resources and Tasks are available:</p>
</div>
<div id="tekton-prerreq-resources" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tkn res ls</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-prerreq-resources"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>The command above should show an output like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                             TYPE    DETAILS
git-source                       git     url: https://github.com/redhat-developer-demos/knative-tutorial
knative-tutorial-greeter-image   image   url: localhost:5000/rhdevelopers/knative-tutorial-greeter:v0.1.1</code></pre>
</div>
</div>
<div id="tekton-prerreq-task-resources" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tkn task ls</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-prerreq-task-resources"><i class="fa fa-clipboard"></i></button><br/>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME        AGE
build-app   5 hours ago</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t see the output as above please ensure you have completed all the exercises of <a href="02-pipeline-resources.html" class="page">Chapter 2</a> and <a href="03-tasks.html" class="page">Chapter 3</a> before proceeding further.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tekton-add-tasks"><a class="anchor" href="#tekton-add-tasks"></a>Add Tasks from catalog</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Tekton Pipelines catalog allows you to reuse the catalog from community repositories. Here is list of repositories which from where you can add tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/tektoncd/catalog">Tekton Pipelines Catalog</a></p>
</li>
<li>
<p><a href="https://github.com/openshift/pipelines-catalog">OpenShift Pipelines Catalog</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the exercise of this chapter we need <a href="https://github.com/knative/client">kn</a> client task that will be used to deploy the built container image as serverless service.</p>
</div>
<div class="paragraph">
<p>The <code>kn</code> Task can be installed from <a href="https://github.com/tektoncd/catalog">Tekton Pipelines Catalog</a> repository:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_kubernetes"></a>Kubernetes</p>
</li>
<li>
<p><a id="tabset3_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_kubernetes">
<div id="tekton-pipeline-add-tasks-k8s" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create -n knativetutorial \
  -f <a href="https://raw.githubusercontent.com/tektoncd/catalog/master/kn/kn.yaml" class="bare">https://raw.githubusercontent.com/tektoncd/catalog/master/kn/kn.yaml</a></code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-pipeline-add-tasks-k8s"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset3_openshift">
<div id="tekton-pipeline-add-tasks-oc" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create -n knativetutorial \
  -f <a href="https://raw.githubusercontent.com/tektoncd/catalog/master/kn/kn.yaml" class="bare">https://raw.githubusercontent.com/tektoncd/catalog/master/kn/kn.yaml</a></code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-pipeline-add-tasks-oc"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>Check the created tasks using the command:</p>
</div>
<div id="tekton-task-ls" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tkn task ls</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-task-ls"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>The Task list should now list the following two Tasks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME        AGE
build-app   5 hours ago
kn          3 minutes ago</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tekton-pipeline-create"><a class="anchor" href="#tekton-pipeline-create"></a>Create a Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using a Pipeline we can run multiple Task together in a user defined sequence or order.</p>
</div>
<div class="paragraph">
<p>Let us use the <code>build-app</code> task that we created in <a href="03-tasks.html#tekton-task-create" class="page">previous chapter</a> and <code>kn</code> task that we deployed in previous step to make Pipeline that will build the application from sources and deploy the built linux container image as Knative serverless service.</p>
</div>
<div class="paragraph">
<p>If you are not in tutorial chapter folder, then navigate to the folder:</p>
</div>
<div id="tekton-res-nav-folder" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd $TUTORIAL_HOME/06-pipelines</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-res-nav-folder"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>The following snippet shows what a Tekton Pipeline YAML looks like:</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/06-pipelines/kn-svc-deploy.yaml">kn-svc-deploy.yaml</a></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: kn-svc-deploy
spec:
  params:
  - name: mavenMirrorUrl
    description: the maven mirror
    default: <a href="http://repo1.maven.apache.org/maven2" class="bare">http://repo1.maven.apache.org/maven2</a>
  resources:
  - name: appSource
    type: git
  - name: appImage
    type: image
  tasks:
   - name: build-java-app
     taskRef:
       name: build-app
     params:
      - name: contextDir
        value: apps/greeter/java/quarkus
      - name: mavenMirrorUrl
        value: "$(params.mavenMirrorUrl)"
     resources:
      inputs:
        - name: source
          resource: appSource
      outputs:
        - name: builtImage
          resource: appImage
   - name: deploy-kn-service
     taskRef:
       name: kn
     runAfter:
      - build-java-app
     resources:
      inputs:
        - name: image
          resource: appImage
     params:
      - name: ARGS
        value:
        - "service"
        - "create"
        - "greeter"
        - "--force"
        - "--image=$(inputs.resources.image.url)"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each Pipeline has the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong> - the unique name using which the Pipeline can be referred</p>
<div class="ulist">
<ul>
<li>
<p><strong>resources</strong> - the pipeline resources that will be used in the Pipeline e.g. appImage, appSource</p>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong> - the name of the input resource using which it can be referenced and bound via <a href="#tekton-pipeline-run">Run Pipeline</a></p>
</li>
<li>
<p><strong>type</strong> - the type of the input resource, typically the pipeline resource type</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>tasks</strong> has one or more Tasks that needs to be executed as part of the Pipeline. In this example we have two Tasks <code>build-java-app</code> and <code>deploy-kn-service</code> that will be run to build the application from sources and deploy the built linux container image as knative service.</p>
</div>
<div class="paragraph">
<p>By default all Tasks of the Pipeline runs in parallel, you can control the execution via <code>runAfter</code> attribute. In this example we make the <code>deploy-kn-service</code> to run after the <code>build-java-app</code>.</p>
</div>
<div class="paragraph">
<p>Each Task in the Pipeline has</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>taskRef</strong> - the reference to an existing defined task via <code>name</code></p>
</li>
<li>
<p><strong>params</strong> - the Task parameters to define or override</p>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong> - the name of the parameter</p>
</li>
<li>
<p><strong>value</strong> - the value of the parameter</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>resources</strong> - used to bind the Pipeline inputs and output resource to Task&#8217;s input and output resource.</p>
</li>
<li>
<p><strong>name</strong> - the local name of the resource</p>
</li>
<li>
<p><strong>resource</strong> - the Pipeline resource (defined under <code>resources</code>) name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this demo the <code>build-app</code> Task needs bind two resources namely <code>source</code> and <code>builtImage</code>. The Pipeline <code>kn-svc-deploy</code> defines two resources <code>appSource</code> and <code>appImage</code> that can be configured via <a href="#tekton-pipeline-run">Run Pipeline</a>.</p>
</div>
<div class="paragraph">
<p>The binding between the Pipeline resource and Task resources is done via the task&#8217;s <code>resources</code> attribute. In this demo we bind <code>appSource</code> &#8594; <code>source</code> and <code>appImage</code> &#8594; <code>builtImage</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Only pipeline resources of same type can be bound. e.g. resource of type <code>git</code> with <code>git</code> or <code>image</code> with <code>image</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tekton-pipeline-deploy"><a class="anchor" href="#tekton-pipeline-deploy"></a>Deploy Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Knative service deployment Pipeline could be created using the command:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_kubernetes"></a>Kubernetes</p>
</li>
<li>
<p><a id="tabset4_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_kubernetes">
<div id="tekton-pipeline-deploy-to-k8s" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/06-pipelines/kn-svc-deploy.yaml">kn-svc-deploy.yaml</a></code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-pipeline-deploy-to-k8s"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset4_openshift">
<div id="tekton-pipeline-deploy-to-oc" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc create -n knativetutorial -f <a href="https://github.com/redhat-developer-demos/knative-tutorial/blob/master/06-pipelines/kn-svc-deploy.yaml">kn-svc-deploy.yaml</a></code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-pipeline-deploy-to-oc"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>We will use the Tekton cli to inspect the created resources</p>
</div>
<div id="tekton-inspect-pipeline" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tkn pipeline ls</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-inspect-pipeline"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>The above command should list one Pipeline as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME            AGE             LAST RUN   STARTED   DURATION   STATUS
kn-svc-deploy   4 seconds ago   ---        ---       ---        ---</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the command <strong>help</strong> via <code>tkn pipeline --help</code> to see more options</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tekton-pipeline-run"><a class="anchor" href="#tekton-pipeline-run"></a>Run Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unlike <a href="03-tasks.html#tekton-task-run-run" class="page">TaskRun</a> we will not be using YAML to trigger PipelineRun, instead we will use the Tekton cli to trigger the pipeline:</p>
</div>
<div id="tekton-trigger-pipelinerun" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tkn pipeline start kn-svc-deploy \
 --resource="appSource=git-source" \<i class="conum" data-value="1"></i><b>(1)</b>
 --resource="appImage=knative-tutorial-greeter-image" \<i class="conum" data-value="2"></i><b>(2)</b>
 --serviceaccount='pipeline' <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-trigger-pipelinerun"><i class="fa fa-clipboard"></i></button><br/>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The resources of the Pipeline could be bound via <code>--resource</code> option, here we bind the Pipeline <code>appSource</code> to pipeline resource <code>git-source</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Bind the Pipeline <code>appImage</code> to pipeline resource <code>knative-tutorial-greeter-image</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The service account to use with Pipeline run</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have maven mirror available then you can modify the above command to use maven mirror:</p>
</div>
<div id="tekton-trigger-pipelinerun-maven-mirror" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tkn pipeline start kn-svc-deploy \
 --param="mavenMirrorUrl=http://192.168.64.1:8081/nexus/content/groups/public" \
 --resource="appSource=git-source" \<i class="conum" data-value="1"></i><b>(1)</b>
 --resource="appImage=knative-tutorial-greeter-image" \<i class="conum" data-value="2"></i><b>(2)</b>
 --serviceaccount='pipeline' <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-trigger-pipelinerun-maven-mirror"><i class="fa fa-clipboard"></i></button><br/>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will use the Tekton cli to inspect the created resources:</p>
</div>
<div id="tekton-inspect-pipelinerun" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tkn pipelinerun ls</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-inspect-pipelinerun"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>The above command should list one PipelineRun as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                      STARTED          DURATION    STATUS
kn-svc-deploy-run-4896t   4 seconds ago    ---         Running</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It will take few seconds for the PipelineRun to show status as <code>Running</code> as it needs to download the container images.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Use the command <strong>help</strong> via <code>tkn pipelinerun --help</code></p>
</li>
<li>
<p>Use <code>pr</code> as shorcut for pipelinerun commands e.g to list pipelinerun run the command <code>tkn pr ls</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To check the status of the PipelineRun use the <code>logs</code> command of pipelinerun like:</p>
</div>
<div id="tekton-pipelinerun-logs" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#list running using the command tkn pr ls
tkn pr ls
# use one task run for which you need the log from list above
tkn pr logs -f -a &lt;pipeline-run-name&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-pipelinerun-logs"><i class="fa fa-clipboard"></i></button><br/>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>-f</code> or <code>-a</code> allows to tail the logs from all the containers of the pipeline tasks. For more options run <code>tkn pr --help</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you see the PipelineRun status as <code>Failed</code> or <code>Error</code> use the following command to check the reason for error:</p>
</div>
<div id="tekton-desc-pipelinerun" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tkn pipelinerun describe &lt;pipelinerun-name&gt;</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-desc-pipelinerun"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
<div class="sect1">
<h2 id="tekton-test-pipeline"><a class="anchor" href="#tekton-test-pipeline"></a>Invoke Service</h2>
<div class="sectionbody">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset5_kubernetes"></a>Kubernetes</p>
</li>
<li>
<p><a id="tabset5_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset5_kubernetes">
<div id="tkn-kubectl-svc-gateway-env" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">IP_ADDRESS="$(minikube ip):$(kubectl get svc istio-ingressgateway --namespace istio-system --output 'jsonpath={.spec.ports[?(@.port==80)].nodePort}')"</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tkn-kubectl-svc-gateway-env"><i class="fa fa-clipboard"></i></button><br/>
<div id="tkn-kubectl-svc-call" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">http $IP_ADDRESS 'Host:greeter.knativetutorial.example.com'</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tkn-kubectl-svc-call"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset5_openshift">
<div id="tkn-openshift-oc-svc-call" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export SVC_URL=`oc get rt greeter -o yaml | yq read - 'status.url'` &amp;&amp; \
http $SVC_URL</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tkn-openshift-oc-svc-call"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>http</code> command should return a response containing a line similar to <strong>Hi  greeter &#8658; '6fee83923a9f' : 1</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sometimes the response might not be returned immediately especially when the pod is coming up from dormant state. In that case, repeat service invocation.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tekton-pipeline-cleanup"><a class="anchor" href="#tekton-pipeline-cleanup"></a>Cleanup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Delete the pipeline service account and its related permissions:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset6_kubernetes"></a>Kubernetes</p>
</li>
<li>
<p><a id="tabset6_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset6_kubernetes">
<div id="tekton-pipeline-cleanup-sa-k8s" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tkn res ls | awk 'NR!=1{print $1}' | xargs kubectl delete pipelineresources &amp;&amp;\
tkn task ls | awk 'NR!=1{print $1}' | xargs kubectl delete tasks &amp;&amp;\
tkn tr ls | awk 'NR!=1{print $1}' | xargs kubectl delete taskruns  &amp;&amp;\
tkn pipeline ls | awk 'NR!=1{print $1}' | xargs kubectl delete pipeline &amp;&amp;\
tkn pr ls | awk 'NR!=1{print $1}' | xargs kubectl delete pipelineruns &amp;&amp;\
kubectl delete -n knativetutorial -f pipeline-sa-role.yaml &amp;&amp;\
kubectl delete -n knativetutorial ksvc greeter</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-pipeline-cleanup-sa-k8s"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="tab-pane" aria-labelledby="tabset6_openshift">
<div id="tekton-pipeline-cleanup-sa-oc" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tkn res ls | awk 'NR!=1{print $1}' | xargs oc delete pipelineresources &amp;&amp;\
tkn task ls | awk 'NR!=1{print $1}' | xargs oc delete tasks &amp;&amp;\
tkn tr ls | awk 'NR!=1{print $1}' | xargs oc delete taskruns  &amp;&amp;\
tkn pipeline ls | awk 'NR!=1{print $1}' | xargs oc pipeline &amp;&amp;\
tkn pr ls | awk 'NR!=1{print $1}' | xargs oc delete pipelineruns &amp;&amp;\
oc delete -n knativetutorial -f pipeline-sa-role.yaml &amp;&amp;\
oc delete -n knativetutorial ksvc greeter</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#tekton-pipeline-cleanup-sa-oc"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer role="contentinfo">
  <div class="region region-rhd-footer">
    <div id="block-rhdfooter" class="rhd-footer">
      <nav class="rhd-footer-nav" aria-label="Secondary Navigation" role="navigation">
  <ul class="rhd-menu">
    <li class="menu-item menu-item--expanded">
      <h3 class="section-toggle">GitHub</h3>
      <ul class="rhd-menu">
        <li class="menu-item">
          <a href="https://github.com/redhat-developer-demos/knative-tutorial" title="Knative Tutorial">Knative
            Tutorial</a>
        </li>
        <li class="menu-item">
          <a href="https://github.com/redhat-developer-demos/knative-tutorial/issues" title="Issue Tracker">Issue
            Tracker</a>
        </li>
         <li class="menu-item">
          <a href="https://github.com/openshift-cloud-functions/Documentation" title="Issue Tracker">OpenShift Cloud Functions</a>
        </li>
      </ul>
    </li>
  </ul>
</nav>      <div class="rhd-footer-sidebar">
        <p class="rhd-footer-sidebar-title">Red Hat Developer</p>
        <p class="rhd-footer-sidebar-subtitle">Build here. Go anywhere.</p>
        <p class="rhd-footer-sidebar-content">
          We serve the builders. The problem solvers who create careers with
          code.<br /><br /><a href="https://developer.redhat.com/register">Join us</a>
          if you’re a developer, software engineer, web designer, front-end
          designer, UX designer, computer scientist, architect, tester,
          product manager, project manager or team lead.
        </p>
        <ul class="rhd-footer-sidebar-social">
          <li>
            <a href="https://www.youtube.com/channel/UC7noUdfWp-ukXUlAsJnSm-Q" target="_blank"
              rel="noopener noreferrer"><svg class="svg-inline--fa fa-youtube fa-w-18" aria-hidden="true"
                data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 576 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z">
                </path>
              </svg><!-- <i class="fab fa-youtube"></i> --></a>
          </li>
          <li>
            <a href="https://www.facebook.com/RedHatDeveloperProgram" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-facebook fa-w-14" aria-hidden="true" data-prefix="fab" data-icon="facebook"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M448 56.7v398.5c0 13.7-11.1 24.7-24.7 24.7H309.1V306.5h58.2l8.7-67.6h-67v-43.2c0-19.6 5.4-32.9 33.5-32.9h35.8v-60.5c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9h-58.4v67.6h58.4V480H24.7C11.1 480 0 468.9 0 455.3V56.7C0 43.1 11.1 32 24.7 32h398.5c13.7 0 24.8 11.1 24.8 24.7z">
                </path>
              </svg><!-- <i class="fab fa-facebook"> </i> --></a>
          </li>
          <li>
            <a href="https://twitter.com/rhdevelopers" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-twitter fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="twitter"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z">
                </path>
              </svg><!-- <i class="fab fa-twitter"> </i> --></a>
          </li>
          <li>
            <a href="https://github.com/redhat-developer" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-github fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="github"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                </path>
              </svg><!-- <i class="fab fa-github"> </i> --></a>
          </li>
        </ul>
        <a class="rhd-footer-sidebar-signup" href="https://developers.redhat.com/register">Sign me up ▸</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>
