[k8s-env='']
[k8s-cli='']

#tag::env[]

ifndef::workshop[]
[#{k8s-env}-svc-gateway-env]
[source,bash,subs="+macros,+attributes"]
----
IP_ADDRESS="$({k8s-env} ip):$({k8s-cli} get svc istio-ingressgateway --namespace istio-system --output 'jsonpath={.spec.ports[?(@.port==80)].nodePort}')"
----
copyToClipboard::{k8s-env}-svc-gateway-env[]
endif::[]

ifdef::workshop[]
[#{k8s-env}-svc-gateway-env]
[source,bash,subs="+macros,+attributes"]
----
GATEWAY_URL=$(oc get svc -n istio-system istio-ingressgateway -o jsonpath='{.status.loadBalancer.ingress[0].hostname}')
----
copyToClipboard::{k8s-env}-svc-gateway-env[]
endif::[]

#end::env[]


#tag::call[]

ifndef::workshop[]
[#{k8s-env}-svc-call]
[source,bash,subs="+macros,+attributes"]
----
http $IP_ADDRESS 'Host:greeter.knativetutorial.example.com'
----
copyToClipboard::{k8s-env}-svc-call[]
endif::[]

ifdef::workshop[]
[#{k8s-env}-svc-call]
[source,bash,subs="+macros,+attributes"]
----
curl -v -H'host:greeter.$WORKSHOP_USER-knativetutorial.example.com' $GATEWAY_URL
----
copyToClipboard::{k8s-env}-svc-call[]

endif::[]

#end::call[]
